server {
  listen __ADMIN_PORT__;
  listen [::]:__ADMIN_PORT__;
  server_name _;
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl;
  listen [::]:443 ssl;
  server_name _;
  ssl_certificate /path/to/fullchain.pem;
  ssl_certificate_key /path/to/privkey.pem;
  root /var/www/signage;
  index index.html;

  # gro√üe Uploads zulassen (muss zu PHP post_max_size passen)
  client_max_body_size 256m;

  add_header X-Content-Type-Options nosniff always;
  add_header X-Frame-Options SAMEORIGIN always;
  add_header Referrer-Policy no-referrer-when-downgrade always;
  add_header X-Served-By signage-admin always;

  location = / { return 302 /admin/; }
  location = /admin { return 302 /admin/; }

  location = /admin/login.html { try_files $uri =404; }
  location = /admin/css/login.css { try_files $uri =404; }
  location = /admin/js/login.js { try_files $uri =404; }

  location /admin/ {
    auth_request /admin/api/login.php;
    error_page 401 =302 /admin/login.html;
    try_files $uri $uri/ /admin/index.html;
  }

  location = /favicon.ico { access_log off; log_not_found off; return 204; }

  location = /admin/api/login.php {
    include snippets/fastcgi-php.conf;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_pass unix:__PHP_SOCK__;
  }

  location ~ ^/admin/api/.*\.php$ {
    auth_request /admin/api/login.php;
    include snippets/fastcgi-php.conf;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_pass unix:__PHP_SOCK__;
  }

  location ^~ /data/ {
    add_header Cache-Control "no-store, must-revalidate" always;
    auth_basic off;                       # WICHTIG: ohne Login
    try_files $uri =404;
  }

  include /etc/nginx/snippets/signage-pairing.conf;
}
