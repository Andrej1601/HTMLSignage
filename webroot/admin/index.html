 <!doctype html> <html lang="de"> <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aufguss ‚Äì Admin</title>
<link rel="stylesheet" href="/admin/css/admin.css">

</head>
<body class="theme-light">
  <header>
    <div class="header-title">
      <h1>Anzeigensteuerung ‚Äì Admin</h1>
      <label class="toggle" title="Hell/Dunkel">
        <input type="checkbox" id="themeMode">
        <svg class="sun" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="4" fill="currentColor"/>
          <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <line x1="12" y1="2" x2="12" y2="4"/>
            <line x1="12" y1="20" x2="12" y2="22"/>
            <line x1="4.93" y1="4.93" x2="6.34" y2="6.34"/>
            <line x1="17.66" y1="17.66" x2="19.07" y2="19.07"/>
            <line x1="2" y1="12" x2="4" y2="12"/>
            <line x1="20" y1="12" x2="22" y2="12"/>
            <line x1="4.93" y1="19.07" x2="6.34" y2="17.66"/>
            <line x1="17.66" y1="6.34" x2="19.07" y2="4.93"/>
          </g>
        </svg>
        <svg class="moon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"/>
        </svg>
      </label>
    </div>
    <div class="header-actions">
      <div class="header-cockpit-controls" role="group" aria-label="Cockpit-Schnellzugriff" hidden>
        <div class="header-cockpit-toggle">
          <button type="button" class="btn ghost sm header-cockpit-btn" data-action="toggle" data-cockpit-control="toggle" data-title-expanded="Cockpit ausblenden" data-title-collapsed="Cockpit anzeigen" aria-controls="adminCockpitBody" aria-expanded="true" aria-label="Cockpit ein-/ausblenden" title="Cockpit ein-/ausblenden">
            <span class="header-cockpit-icon" data-role="icon" data-icon-expanded="‚ñæ" data-icon-collapsed="‚ñ∏" aria-hidden="true">‚ñæ</span>
            <span class="header-cockpit-label" data-role="label" data-label-expanded="Cockpit" data-label-collapsed="Cockpit">Cockpit</span>
          </button>
          <button type="button" class="btn ghost xs header-cockpit-pin" data-action="pin" data-cockpit-control="pin" aria-pressed="false" aria-label="Cockpit anheften" title="Cockpit anheften">
            <span class="header-cockpit-icon" data-role="icon" data-icon-pinned="üìç" data-icon-unpinned="üìå" aria-hidden="true">üìå</span>
            <span class="sr-only" data-role="label" data-label-pinned="Angeheftet" data-label-unpinned="Nicht angeheftet">Nicht angeheftet</span>
          </button>
        </div>
      </div>
      <!-- Ansicht-Men√º -->
      <button class="btn" id="btnDevices">Ger√§te</button>
      <div class="menuwrap" id="viewMenuWrap">
        <button class="btn" id="viewMenuBtn" aria-haspopup="menu" aria-expanded="false">
          Ansicht: <span id="viewMenuLabel">Grid</span> ‚ñæ
        </button>
      <div class="dropdown" id="viewMenu" role="menu" hidden>
        <button class="dd-item" role="menuitemradio" data-view="grid" aria-checked="true">‚ñ¶ Grid</button>
        <button class="dd-item" role="menuitemradio" data-view="preview" aria-checked="false">‚ñ∂ Vorschau</button>
      </div>
    </div>
      <button class="btn" id="btnOpen">Slideshow √∂ffnen</button>
      <button class="btn primary" id="btnSave">Speichern</button>
      <span id="unsavedBadge" class="unsaved-badge" hidden role="status" aria-live="polite">
        <span class="unsaved-badge-icon" aria-hidden="true"></span>
        <span class="unsaved-badge-content">
          <span class="unsaved-badge-title" data-role="unsaved-title">√Ñnderungen nicht gespeichert</span>
          <span class="unsaved-badge-detail" data-role="unsaved-detail">Lokal ge√§nderte Inhalte warten auf das Speichern.</span>
        </span>
        <button type="button" class="unsaved-badge-btn" id="unsavedBadgeReset" aria-label="√Ñnderungen verwerfen">‚ü≥</button>
      </span>
    </div>
  </header>

  <main class="layout">
    <section class="workspace-overview cockpit-compact" aria-label="Cockpit-Schnellzugriff" data-collapsed="false" data-pinned="false" hidden>
      <header class="workspace-toolbar">
        <p class="workspace-subtitle">Schnellzugriff auf Vorschau, Ger√§te, Planung und Inhalte.</p>
      </header>

      <div class="workspace-body" id="adminCockpitBody">
        <div class="workspace-grid" role="list">
          <article class="workspace-card" role="listitem">
            <div class="workspace-card-head">
              <span class="workspace-card-icon" aria-hidden="true">üñ•Ô∏è</span>
              <h3>Vorschau &amp; Ger√§te</h3>
            </div>
            <div class="workspace-card-actions">
              <button type="button" class="workspace-card-btn primary" data-view="preview" data-highlight="dockPane">Vorschau √∂ffnen</button>
              <button type="button" class="workspace-card-btn" data-devices="toggle" data-highlight="devicesPane">Ger√§te</button>
              <button type="button" class="workspace-card-btn" data-devices="refresh" data-highlight="devicesPane">Status aktualisieren</button>
            </div>
          </article>

          <article class="workspace-card" role="listitem">
            <div class="workspace-card-head">
              <span class="workspace-card-icon" aria-hidden="true">üóìÔ∏è</span>
              <h3>Tagesplan &amp; Wochenablauf</h3>
            </div>
            <div class="workspace-card-actions">
              <button type="button" class="workspace-card-btn primary" data-view="grid" data-jump="gridPane" aria-controls="gridPane">Plan bearbeiten</button>
            </div>
          </article>

          <article class="workspace-card" role="listitem">
            <div class="workspace-card-head">
              <span class="workspace-card-icon" aria-hidden="true">üî•</span>
              <h3>Saunen &amp; Hinweise</h3>
            </div>
            <div class="workspace-card-actions">
              <button type="button" class="workspace-card-btn primary" data-jump="boxSaunas" aria-controls="boxSaunas">Saunen √∂ffnen</button>
              <button type="button" class="workspace-card-btn" data-jump="boxFootnotes" aria-controls="boxFootnotes">Fu√ünoten &amp; Badges</button>
              <button type="button" class="workspace-card-btn" data-jump="badgeLibrarySection" aria-controls="badgeLibrarySection">Badge-Bibliothek</button>
            </div>
          </article>

          <article class="workspace-card" role="listitem">
            <div class="workspace-card-head">
              <span class="workspace-card-icon" aria-hidden="true">üé¨</span>
              <h3>Slides &amp; Automationen</h3>
            </div>
            <div class="workspace-card-actions">
              <button type="button" class="workspace-card-btn primary" data-jump="slidesMaster" aria-controls="slidesMaster">Ablauf steuern</button>
              <button type="button" class="workspace-card-btn" data-jump="slidesFlowCard" aria-controls="slidesFlowCard">Zeitsteuerung</button>
              <button type="button" class="workspace-card-btn" data-jump="slidesAutomationCard" aria-controls="slidesAutomationCard">Automatisierung</button>
            </div>
          </article>

          <article class="workspace-card" role="listitem">
            <div class="workspace-card-head">
              <span class="workspace-card-icon" aria-hidden="true">üñºÔ∏è</span>
              <h3>Infos &amp; Story-Slides</h3>
            </div>
            <div class="workspace-card-actions">
              <button type="button" class="workspace-card-btn primary" data-jump="boxStories" aria-controls="boxStories">Zusatzinfos</button>
              <button type="button" class="workspace-card-btn" data-jump="infoWellness" aria-controls="infoWellness">Wellness-Tipps</button>
              <button type="button" class="workspace-card-btn" data-jump="infoEvents" aria-controls="infoEvents">Event-Countdowns</button>
              <button type="button" class="workspace-card-btn" data-jump="infoGastro" aria-controls="infoGastro">Gastro-Infos</button>
              <button type="button" class="workspace-card-btn" data-jump="heroTimelineEnabled" aria-controls="infoEvents">Hero-Timeline</button>
              <button type="button" class="workspace-card-btn" data-jump="infoStories" aria-controls="infoStories">Story-Slides</button>
            </div>
          </article>

          <article class="workspace-card" role="listitem">
            <div class="workspace-card-head">
              <span class="workspace-card-icon" aria-hidden="true">üé®</span>
              <h3>Medien &amp; Layout</h3>
            </div>
            <div class="workspace-card-actions">
              <button type="button" class="workspace-card-btn primary" data-jump="boxImages" aria-controls="boxImages">Medienbereich</button>
              <button type="button" class="workspace-card-btn" data-jump="boxSlidesText" aria-controls="boxSlidesText">Slideshow &amp; Text</button>
              <button type="button" class="workspace-card-btn" data-jump="displayLayoutFold" aria-controls="displayLayoutFold">Darstellung &amp; Seiten</button>
              <button type="button" class="workspace-card-btn" data-jump="styleSetControls" aria-controls="styleSetControls">Style-Paletten</button>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section class="leftcol">
    <div class="card" id="gridPane" data-jump-target>
        <div class="content" style="padding-bottom:0">
<div class="row" id="planHead" style="justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;flex-wrap:wrap">
  <div style="font-weight:700">Aufgussplan <span class="mut">(<span id="activeDayLabel">‚Äî</span>)</span></div>
  <div id="gridActionsLeft" class="row" style="gap:6px">
    <button class="btn sm" id="btnUndo" title="R√ºckg√§ngig" disabled>‚Ü∂ R√ºckg√§ngig</button>
    <button class="btn sm" id="btnRedo" title="Wiederholen" disabled>‚Ü∑ Wiederholen</button>
  </div>
<div class="row" style="gap:8px;flex-wrap:wrap">
    <div id="weekdayPills" class="row" style="gap:6px"></div>
    <button class="btn sm" id="btnSavePreset" title="Wochentag speichern">üíæ Wochentag speichern</button>
    <span class="mut">Ausgew√§hlte Zeit:</span> <span id="selTime" style="font-weight:700">‚Äî</span>
  </div>
</div>
          <table id="grid" class="tbl"></table>
          <div class="row" style="margin:12px 0 4px">
            <button class="btn sm" id="btnAddAbove">Zeile dar√ºber +</button>
            <button class="btn sm" id="btnAddBelow">Zeile darunter +</button>
            <button class="btn sm" id="btnDeleteRow">Ausgew√§hlte Zeile l√∂schen</button>
            <span class="mut">Zeit anklicken = Zeile markieren ¬∑ Zeit√§nderungen im Dialog verschieben Aufguss korrekt.</span>
          </div>
        </div>
      </div>
    </section>

    <aside class="rightbar">
      <div class="layout-resizer" id="layoutResizer" role="separator" aria-orientation="vertical" aria-label="Sidebar-Gr√∂√üe anpassen" tabindex="0" aria-hidden="false"></div>
      <div class="rightbar-inner">
        <header class="sidebar-header">
          <div class="sidebar-header-text">
            <h2 class="sidebar-title">Einstellungen &amp; Inhalte</h2>
            <p class="sidebar-subtitle">Strukturiere Ablauf, Aufg√ºsse, Zusatzinformationen und Layout-Anpassungen zentral.</p>
          </div>
          <nav class="sidebar-nav" aria-label="Bereiche der Seitenleiste">
            <button type="button" class="sidebar-nav-btn is-active" data-scroll-target="sidebarFlow" aria-controls="sidebarFlow">
              Ablauf &amp; Automationen
            </button>
            <button type="button" class="sidebar-nav-btn" data-scroll-target="sidebarAufguss" aria-controls="sidebarAufguss">
              Aufg√ºsse &amp; Hinweise
            </button>
            <button type="button" class="sidebar-nav-btn" data-scroll-target="sidebarExtras" aria-controls="sidebarExtras">
              Zusatzinhalte
            </button>
            <button type="button" class="sidebar-nav-btn" data-scroll-target="sidebarMedia" aria-controls="sidebarMedia">
              Medien &amp; Layout
            </button>
          </nav>
        </header>

        <section class="sidebar-section" id="sidebarFlow" data-sidebar-section>
          <div class="sidebar-section-head">
            <h3 class="sidebar-section-title">Ablauf &amp; Automationen</h3>
            <p class="sidebar-section-description">Steuere Reihenfolge, Zeiten und automatische Voreinstellungen deiner Slides.</p>
          </div>
          <div class="sidebar-section-body rightbar-columns">
            <!-- Slides ‚Äì Masterbox -->
            <details class="ac full" open id="slidesMaster" data-jump-target>
              <summary>
                <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Slides ‚Äì Reihenfolge, Sichtbarkeit & Zeiten</div>
                <div class="actions">
                  <button class="btn sm ghost" id="resetTiming">Standardwerte</button>
                </div>
              </summary>
              <div class="content">
                <div class="settings-stack">
                  <div class="settings-card" id="slidesAutomationCard" data-jump-target hidden>
                    <div class="settings-card-head">
                      <div class="settings-card-title">Automatisierung</div>
                      <p class="settings-card-description">L√§dt zu Start oder Tab-Wechsel automatisch passende Voreinstellungen.</p>
                    </div>
                    <details class="settings-card-body style-auto-fold" id="styleAutomationFold" open>
                      <summary class="style-auto-summary">
                        <span class="style-auto-summary-text">Automatisierung konfigurieren</span>
                        <span class="style-auto-summary-chev" aria-hidden="true">‚ñæ</span>
                      </summary>
                      <div class="style-auto-inner">
                        <div class="kv">
                          <label>Auto je Wochentag</label>
                          <input id="presetAuto" type="checkbox">
                        </div>
                        <div class="help">Wenn aktiv, wird beim √ñffnen und beim Wechsel des Tabs automatisch das Preset des aktuellen Wochentags geladen (falls vorhanden).</div>
                        <div class="divider"></div>
                        <div class="kv">
                          <label>Style-Automation aktiv</label>
                          <input id="styleAutoEnabled" type="checkbox">
                        </div>
                        <div class="kv">
                          <label>Fallback-Stil</label>
                          <select id="styleAutoFallback" class="input"></select>
                        </div>
                        <div class="kv">
                          <label>Fallback-Musik</label>
                          <select id="styleAutoFallbackTrack" class="input"></select>
                        </div>
                        <div class="style-auto-list" id="styleAutoList"></div>
                        <div class="row style-auto-actions">
                          <button class="btn sm" id="styleAutoAdd">Zeitfenster hinzuf√ºgen</button>
                        </div>
                      </div>
                    </details>
                  </div>

                </div>

              </div>
            </details>
          </div>
        </section>

        <section class="sidebar-section" id="sidebarAufguss" data-sidebar-section>
          <div class="sidebar-section-head">
            <h3 class="sidebar-section-title">Aufg√ºsse &amp; Hinweise</h3>
            <p class="sidebar-section-description">Verwalte Saunen, Fu√ünoten und Badges je nach Tagesplan.</p>
          </div>
          <div class="sidebar-section-body rightbar-columns">
            <!-- Unterbox 1: Saunen & √úbersicht -->
            <details class="ac sub" open id="boxSaunas" data-jump-target>
              <summary>
                <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Saunen & √úbersicht</div>
                <div class="actions"><button class="btn sm" id="btnAddSauna">Sauna hinzuf√ºgen</button></div>
              </summary>
              <div class="content">

                <!-- √úbersicht im Saunen-Stil -->
                <div class="fieldset" style="margin-bottom:10px">
                  <div class="legend">√úbersicht (Aufgussplan)</div>
                  <div id="overviewRow"></div>
                </div>

                <!-- Saunenliste -->
                <!-- Kopf f√ºr den Bereich "Aufguss" + 2. Wochentags-Pillen -->
                <div class="groupHead">
                  <div class="legend">Aufguss</div>
                  <div id="weekdayPills2" class="day-pills row" style="gap:6px"></div>
                </div>
                <!-- Aufguss -->
                <div class="sl-head sl-saunas">
                  <span class="col-name">Name</span>
                  <span class="col-prev">Preview</span>
                  <span class="col-dur" id="headSaunaDur">Dauer (s)*</span>
                  <span class="col-up">Upload</span>
                  <span class="col-def">Default</span>
                  <span class="col-del">‚úï</span>
                  <span class="col-vis">Status</span>
                </div>

                <!-- kein Aufguss -->
                <div id="saunaList"></div>
                <div class="subh" id="extraTitle" style="display:none">Inventar</div>
                <div id="extraSaunaList"></div>

                <div class="help" style="margin-top:6px">* Dauer nur sichtbar, wenn ‚ÄûIndividuell‚Äú gew√§hlt ist.</div>
              </div>
            </details>

            <!-- Unterbox 2: Fu√ünoten & Badges -->
            <details class="ac sub" id="boxFootnotes" data-jump-target>
              <summary>
                <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Fu√ünoten &amp; Badges</div>
                <div class="actions"><button class="btn sm" id="fnAdd">Fu√ünote hinzuf√ºgen</button></div>
              </summary>
              <div class="content">
                <div class="footnote-section" id="footnoteSection" data-jump-target>
                  <div class="footnote-header">
                    <button class="footnote-toggle" type="button" id="footnoteToggle" aria-expanded="false" aria-controls="footnoteBody">Fu√ünoten verwalten</button>
                  </div>
                  <div class="footnote-body" id="footnoteBody" aria-hidden="true">
                    <div class="footnote-body-inner">
                      <div id="fnList"></div>
                    </div>
                  </div>
                </div>
                <div class="footnote-layout" id="footnoteLayoutSection">
                  <div class="subh">Darstellung</div>
                  <div class="kv">
                    <label>Fu√ünoten-Layout</label>
                    <select id="footnoteLayout" class="input">
                      <option value="one-line" selected>M√∂glichst einzeilig</option>
                      <option value="multi">Mehrzeilig</option>
                      <option value="stacked">Untereinander (jede Zeile)</option>
                      <option value="ticker">Ticker (laufend)</option>
                      <option value="split">Zweispaltig</option>
                    </select>
                  </div>
                  <div class="kv"><label>Fu√ünoten in √úbersicht anzeigen</label><input id="footnoteOverviewToggle" type="checkbox" checked></div>
                </div>
                <div class="badge-lib-section" id="badgeLibrarySection" data-jump-target>
                  <div class="badge-lib-header">
                    <button class="badge-lib-toggle" type="button" id="badgeLibraryToggle" aria-expanded="false" aria-controls="badgeLibraryBody">Badge-Bibliothek</button>
                    <button class="btn sm" id="badgeAdd" type="button">Badge hinzuf√ºgen</button>
                  </div>
                  <div class="badge-lib-body" id="badgeLibraryBody" aria-hidden="true">
                    <div class="badge-lib-body-inner">
                      <div id="badgeLibraryList" class="badge-library-list"></div>
                      <div class="help">Verwalte Emoji, Bild und Label der ausw√§hlbaren Badges f√ºr Aufg√ºsse.</div>
                    </div>
                  </div>
                </div>
              </div>
            </details>
          </div>
        </section>

        <section class="sidebar-section" id="sidebarExtras" data-sidebar-section>
          <div class="sidebar-section-head">
            <h3 class="sidebar-section-title">Zusatzinhalte</h3>
            <p class="sidebar-section-description">Plane Wellness-Tipps, Event-Countdowns und Story-Slides.</p>
          </div>
          <div class="sidebar-section-body rightbar-columns">
            <!-- Unterbox 4: Globale Zusatzinhalte & Informationen -->
            <details class="ac sub" id="boxStories" data-jump-target>
              <summary>
                <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Global Zusatzinhalte &amp; Informationen</div>
              </summary>
              <div class="content global-info-pane">
                <div class="global-info-sections">
                  <details class="info-fold" id="infoWellness" open data-jump-target>
                    <summary>Wellness-Tipps</summary>
                    <div class="info-fold-body">
                      <div class="extras-group" id="extrasWellness">
                        <div class="extras-group-head">
                          <div class="extras-group-title">Wellness-Tipps</div>
                          <button class="btn sm" id="extrasWellnessAdd">Tipp hinzuf√ºgen</button>
                        </div>
                        <div class="extras-group-list" id="extrasWellnessList"></div>
                      </div>
                    </div>
                  </details>
                  <details class="info-fold" id="infoEvents" open data-jump-target>
                    <summary>Event-Countdowns</summary>
                    <div class="info-fold-body">
                      <div class="extras-group" id="extrasEvents">
                        <div class="extras-group-head">
                          <div class="extras-group-title">Event-Countdowns</div>
                          <button class="btn sm" id="extrasEventAdd">Event hinzuf√ºgen</button>
                        </div>
                        <div class="kv">
                          <label class="row" style="gap:8px;align-items:center">
                            <input id="heroTimelineEnabled" type="checkbox">
                            <span>Event Countdown im Hero anzeigen</span>
                          </label>
                        </div>
                        <div class="kv" id="heroTimelineSettings" hidden>
                          <label>Einstellungen</label>
                          <div class="row" style="gap:8px;align-items:center;flex-wrap:wrap">
                            <span class="mut">Slide-Dauer (s)</span>
                            <input id="heroTimelineDuration" class="input num3" type="number" min="1" max="180" step="1">
                            <span class="mut">Basis-Minuten</span>
                            <input id="heroTimelineBase" class="input num3" type="number" min="1" max="240" step="1">
                            <span class="mut">Max. Eintr√§ge</span>
                            <input id="heroTimelineMax" class="input num3" type="number" min="1" max="50" step="1" placeholder="leer = alle">
                          </div>
                          <div class="row" style="gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px">
                            <span class="mut">Scrolltempo (px/s)</span>
                            <input id="heroTimelineScrollSpeed" class="input num3" type="number" min="4" max="240" step="1">
                            <span class="mut">Scroll-Pause (s)</span>
                            <input id="heroTimelineScrollPause" class="input num3" type="number" min="0" max="30" step="0.5">
                          </div>
                          <label class="row" style="gap:8px;align-items:center;margin-top:12px">
                            <input id="heroTimelineWaitForScroll" type="checkbox">
                            <span>Slide erst nach vollst√§ndigem Scrollen wechseln</span>
                          </label>
                        </div>
                        <div class="extras-group-list" id="extrasEventList"></div>
                        <div class="help">Datums- und Zeitangabe im lokalen Format, z.&nbsp;B. 2024-12-24T20:00.</div>
                      </div>
                    </div>
                  </details>
                  <details class="info-fold" id="infoModules" open data-jump-target>
                    <summary>Info-Module</summary>
                    <div class="info-fold-body">
                      <div class="extras-group" id="extrasInfoModules">
                        <div class="extras-group-head">
                          <div class="extras-group-title">Info-Module</div>
                          <button class="btn sm" id="extrasInfoModuleAdd">Eintrag hinzuf√ºgen</button>
                        </div>
                        <div class="extras-group-list" id="extrasInfoModuleList"></div>
                      </div>
                    </div>
                  </details>
                  <details class="info-fold" id="infoStories" data-jump-target>
                    <summary>Story-Slides</summary>
                    <div class="info-fold-body story-fold-body">
                      <div class="info-fold-actions"><button class="btn sm" id="btnStoryAdd">Information hinzuf√ºgen</button></div>
                      <div class="story-builder-pane">
                        <div class="subh">Informationen</div>
                        <div class="help">Pflege Texte, Bilder und Layout f√ºr erkl√§rende Slides in einem flexiblen Spalten-Baukasten.</div>
                        <div class="story-builder" id="storyBuilder">
                          <div class="story-builder-list" id="storyList"></div>
                        </div>
                      </div>
                    </div>
                  </details>
                </div>
              </div>
            </details>
          </div>
        </section>

        <section class="sidebar-section" id="sidebarMedia" data-sidebar-section>
          <div class="sidebar-section-head">
            <h3 class="sidebar-section-title">Medien &amp; Layout</h3>
            <p class="sidebar-section-description">Passe Medien-Slides, Layout, Typografie und Audio zentral an.</p>
          </div>
          <div class="sidebar-section-body rightbar-columns">
            <!-- Unterbox 4: Medien-Slides -->
            <details class="ac sub" id="boxImages" data-jump-target>
              <summary>
                <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Medien-Slides</div>
                <div class="actions"><button class="btn sm" id="btnMediaAdd">Medien hinzuf√ºgen</button></div>
              </summary>
              <small class="help">* Dauer nur sichtbar, wenn ‚ÄûIndividuell pro Slide‚Äú gew√§hlt ist.</small>
              <div class="content">
                <div class="sl-head sl-images">
                  <span class="col-name">Name</span>
                  <span class="col-type">Typ</span>
                  <span class="col-prev">Preview</span>
                  <span class="col-dur" id="headImgDur">Dauer (s)</span>
                  <span class="col-audio">Ton</span>
                  <span class="col-wait">Video-Ende</span>
                  <span class="col-up">Upload</span>
                  <span class="col-del">‚úï</span>
                  <span class="col-vis">Anzeigen</span>
                </div>
                <div id="interList2"></div>
              </div>
            </details>

            <details class="ac full" id="boxSlidesText" data-jump-target>
              <summary>
                <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Slideshow &amp; Text</div>
                <div class="actions"><button class="btn sm ghost" id="resetSlides">Standardwerte</button></div>
              </summary>
              <div class="content">
                <div class="layout-display-block">
                  <details class="layout-display-fold" id="displayLayoutFold" open data-jump-target>
                    <summary class="layout-display-summary">
                      <span class="layout-display-summary-text">
                        <span class="layout-display-summary-title">Darstellung &amp; Seiten</span>
                        <span class="layout-display-summary-sub">Einspaltig oder Zweispaltig konfigurieren</span>
                      </span>
                      <span class="layout-display-chev" aria-hidden="true">‚ñæ</span>
                    </summary>
                    <div class="layout-display-body">
                      <div class="kv">
                        <label>Darstellung</label>
                        <select id="layoutMode" class="input">
                          <option value="single">Einspaltig</option>
                          <option value="split">Zweispaltig</option>
                        </select>
                      </div>
                      <div class="kv">
                        <label>Layout-Profil</label>
                        <select id="layoutProfile" class="input">
                          <option value="landscape">Standard (16:9)</option>
                          <option value="portrait">Portrait ‚Äì Einzel</option>
                          <option value="portrait-split">Portrait ‚Äì geteilte Bereiche</option>
                          <option value="triple">Triple-Column</option>
                          <option value="asymmetric">Asymmetrisch</option>
                          <option value="info-panel">Info-Panel (Seitenleiste)</option>
                          <option value="banner">Banner (Top/Bottom)</option>
                        </select>
                      </div>
                      <div class="kv">
                        <label>Info-Banner Platzierung</label>
                        <select id="infoBannerMode" class="input">
                          <option value="full">√úber gesamte Breite</option>
                          <option value="left">Linke Spalte</option>
                          <option value="right">Rechte Spalte</option>
                        </select>
                      </div>
                      <div class="kv">
                        <label>Info-Banner H√∂he (% vom Bildschirm)</label>
                        <input id="infoBannerHeight" class="input num3" type="number" min="2" max="40" step="1" placeholder="10">
                        <div class="help">Steuert den reservierten Bereich f√ºr den laufenden Hinweisbanner.</div>
                      </div>
                      <div class="divider"></div>
                      <div class="layout-flow-section">
                        <div class="subh">Ablauf &amp; Zeitsteuerung</div>
                        <p class="help" style="margin-top:-4px">Bestimme Dauer, √úberg√§nge und Verhalten beim Abspielen.</p>
                        <div class="kv" id="rowDurMode">
                          <label>Dauer-Modus</label>
                          <div class="row">
                            <label class="btn sm ghost" style="gap:6px"><input type="radio" name="durMode" id="durUniform" value="uniform"> Einheitlich</label>
                            <label class="btn sm ghost" style="gap:6px"><input type="radio" name="durMode" id="durPer" value="per"> Individuell pro Slide</label>
                          </div>
                        </div>
                        <div class="kv" id="rowDwellAll">
                          <label>Dauer (einheitlich)</label>
                          <div class="row" style="gap:8px;align-items:center;flex-wrap:wrap">
                            <span class="mut" style="min-width:14ch;">alle au√üer √úbersicht</span>
                            <input id="dwellAll" class="input num3" type="number" min="1" max="120" step="1" />
                            <span class="mut" style="min-width:10ch;">√úbersicht</span>
                            <input id="ovSecGlobal" class="input num3" type="number" min="1" max="120" step="1" />
                          </div>
                        </div>
                        <div class="kv">
                          <label>Transition (ms)</label>
                          <input id="transMs2" class="input" type="number" min="0" value="500">
                        </div>
                      </div>
                      <div class="layout-display-columns">
                        <div class="fieldset layout-page" id="layoutLeft">
                          <div class="legend">Linke Seite</div>
                          <div class="kv">
                            <label>Timer (Sekunden)</label>
                            <input id="pageLeftTimer" class="input num3" type="number" min="0" max="600" step="1" placeholder="0 = global">
                          </div>
                          <div class="kv playlist-row">
                            <label class="sr-only">Playlist</label>
                            <div class="playlist-selector" id="pageLeftPlaylist" aria-label="Playlist"></div>
                            <div class="help">Klicken zum (De-)Aktivieren, Pfeile oder Ziehen f√ºr die Reihenfolge. Eine leere Playlist nutzt den Standardfilter.</div>
                          </div>
                        </div>
                        <div class="fieldset layout-page" id="layoutRight">
                          <div class="legend">Rechte Seite</div>
                          <div class="kv">
                            <label>Timer (Sekunden)</label>
                            <input id="pageRightTimer" class="input num3" type="number" min="0" max="600" step="1" placeholder="0 = global">
                          </div>
                          <div class="kv playlist-row">
                            <label class="sr-only">Playlist</label>
                            <div class="playlist-selector" id="pageRightPlaylist" aria-label="Playlist"></div>
                            <div class="help">Klicken zum (De-)Aktivieren, Pfeile oder Ziehen f√ºr die Reihenfolge.</div>
                          </div>
                          <div class="help">Wird verwendet, wenn das Zweispalten-Layout aktiv ist.</div>
                        </div>
                      </div>
                    </div>
                  </details>
                </div>
                <div class="settings-grid two-col">
                  <div class="settings-card">
                    <div class="settings-card-head">
                      <div class="settings-card-title">Style Paletten</div>
                    </div>
                    <div class="settings-card-body">
                      <div class="kv">
                        <label>Stil-Paletten</label>
                        <div class="style-set-controls" id="styleSetControls" data-jump-target>
                          <select id="styleSetSelect" class="input"></select>
                          <div class="row" style="gap:6px;flex-wrap:wrap">
                            <button class="btn sm" id="styleSetApply" type="button">Aktivieren</button>
                            <button class="btn sm ghost" id="styleSetSave" type="button">Aktualisieren</button>
                            <button class="btn sm ghost" id="styleSetCreate" type="button">Neu</button>
                            <button class="btn sm ghost" id="styleSetDelete" type="button">L√∂schen</button>
                          </div>
                        </div>
                      </div>
                      <div class="kv"><label>Palettenname</label><input id="styleSetLabel" class="input" type="text" placeholder="Palette"></div>
                      <div class="help">Paletten speichern Farben, Typografie und Badge-Optionen. ‚ÄûAktivieren‚Äú √ºbernimmt die Auswahl in die aktuellen Einstellungen.</div>
                    </div>
                  </div>

                  <div class="settings-card" id="backgroundAudioCard">
                    <div class="settings-card-head">
                      <div class="settings-card-title">Hintergrundmusik</div>
                    </div>
                    <div class="settings-card-body">
                      <div class="kv">
                        <label class="row" style="gap:8px;align-items:center">
                          <input id="bgAudioEnabled" type="checkbox">
                          <span>Hintergrundmusik abspielen</span>
                        </label>
                      </div>
                      <div class="kv">
                        <label>Musik-Preset</label>
                        <div class="style-set-controls" id="bgAudioTrackControls" data-jump-target>
                          <select id="bgAudioTrackSelect" class="input"></select>
                          <div class="row" style="gap:6px;flex-wrap:wrap">
                            <button class="btn sm" id="bgAudioTrackApply" type="button">Aktivieren</button>
                            <button class="btn sm ghost" id="bgAudioTrackSave" type="button">Aktualisieren</button>
                            <button class="btn sm ghost" id="bgAudioTrackCreate" type="button">Neu</button>
                            <button class="btn sm ghost" id="bgAudioTrackDelete" type="button">L√∂schen</button>
                          </div>
                        </div>
                      </div>
                      <div class="kv">
                        <label>Bezeichnung</label>
                        <input id="bgAudioTrackLabel" class="input" type="text" placeholder="z. B. Lobby">
                      </div>
                      <div class="kv">
                        <label>Quelle</label>
                        <div class="row" style="gap:8px;align-items:center;flex-wrap:wrap">
                          <input id="bgAudioSrc" class="input" type="text" placeholder="/assets/media/audio/datei.mp3">
                          <button class="btn sm" id="bgAudioUpload" type="button">Upload</button>
                          <button class="btn sm ghost" id="bgAudioClear" type="button">Entfernen</button>
                        </div>
                        <div class="help">Unterst√ºtzt MP3- und OGG-Dateien. Bei leerem Feld bleibt die Musik deaktiviert.</div>
                      </div>
                      <div class="kv">
                        <label>Lautst√§rke (%)</label>
                        <input id="bgAudioVolume" class="input num3" type="number" min="0" max="100" step="5" placeholder="100">
                        <div class="help">0 = stumm, 100 = volle Lautst√§rke.</div>
                      </div>
                      <div class="kv">
                        <label class="row" style="gap:8px;align-items:center">
                          <input id="bgAudioLoop" type="checkbox">
                          <span>Automatisch wiederholen</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <div class="settings-card">
                    <div class="settings-card-head">
                      <div class="settings-card-title">Typografie ‚Äì Basis</div>
                    </div>
                    <div class="settings-card-body">
                      <div class="kv"><label>Schriftfamilie</label>
                        <select id="fontFamily" class="input">
                          <option value="system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans, Ubuntu, Cantarell, 'Helvetica Neue',sans-serif">System (Default)</option>
                          <option value="Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif">Montserrat</option>
                          <option value="Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif">Roboto</option>
                          <option value="'Open Sans', system-ui, -apple-system, Segoe UI, Arial, sans-serif">Open Sans</option>
                          <option value="Lato, system-ui, -apple-system, Segoe UI, Arial, sans-serif">Lato</option>
                        </select>
                      </div>
                      <div class="kv"><label>Grundgr√∂√üe</label><input id="fontScale" class="input num3" type="number" step="0.05" min="0.5" max="2" value="1"></div>
                      <div class="kv"><label>H1-Skalierung</label><input id="h1Scale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>H2-Skalierung</label><input id="h2Scale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>√úberschrift √úbersicht</label><input id="ovTitleScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Spaltenkopf √úbersicht</label><input id="ovHeadScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="0.9"></div>
                      <div class="kv"><label>Zelle √úbersicht</label><input id="ovCellScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="0.8"></div>
                      <div class="kv"><label>Zeit √úbersicht</label><input id="ovTimeScale" class="input num3" type="number" step="0.05" min="0.4" max="3" value="0.8"></div>
                      <div class="kv"><label>Zeit-Breite √úbersicht</label><input id="ovTimeWidthScale" class="input num3" type="number" step="0.05" min="0.4" max="2" value="1"></div>
                    </div>
                  </div>

                  <div class="settings-card">
                    <div class="settings-card-head">
                      <div class="settings-card-title">Typografie ‚Äì Details</div>
                    </div>
                    <div class="settings-card-body">
                      <div class="kv"><label>Flie√ütext</label><input id="bodyScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Timer</label><input id="timerScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Badge-Titel</label><input id="badgeTitleScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Badge-Emoji</label><input id="badgeEmojiScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Badge-Label</label><input id="badgeLabelScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Fu√ünote Text</label><input id="footnoteScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                      <div class="kv"><label>Fu√ünote Label</label><input id="footnoteLabelScale" class="input num3" type="number" step="0.05" min="0.5" max="3" value="1"></div>
                    </div>
                  </div>

                  <div class="settings-card">
                    <div class="settings-card-head">
                      <div class="settings-card-title">Layout ‚Äì Aufguss√ºbersicht</div>
                    </div>
                    <div class="settings-card-body">
                      <div class="kv"><label>Spaltenbreite ‚Äì Saunaname (%)</label><input id="saunaTitleMaxWidth" class="input num3" type="number" min="30" max="80" step="1"></div>
                      <div class="kv"><label>Spaltenbreite ‚Äì Badges (%)</label><input id="saunaBadgeWidth" class="input num3" type="number" min="10" max="40" step="1"></div>
                      <div class="kv"><label>Spaltenbreite ‚Äì Notizen (%)</label><input id="saunaNoteWidth" class="input num3" type="number" min="10" max="40" step="1"></div>
                      <div class="kv"><label>Aufgussdetails anzeigen</label><input id="saunaShowDetails" type="checkbox"></div>
                      <div class="kv"><label>Inventar anzeigen</label><input id="saunaShowInventory" type="checkbox"></div>
                    </div>
                  </div>
                </div>
              </div>
            </details>
          </div>
        </section>
      </div>
    </aside>

  </main>

  <footer>¬© Andrej Soennecken</footer>

  <!-- Dialog Zelle -->
  <div id="modal" class="modal">
    <div class="box">
      <div class="grid2">
        <label>Uhrzeit</label><input id="m_time" class="input" type="text" placeholder="HH:MM">
        <label>Titel</label><input id="m_title" class="input" type="text" placeholder="z.B. Vulkan">
        <label>Flammen</label>
        <select id="m_flames" class="input">
          <option value="">‚Äî</option>
          <option>1</option><option>2</option><option>3</option>
        </select>
        <label>Fu√ünote</label>
        <div>
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="m_hasNote"> hinzuf√ºgen</label>
          <div class="row" id="m_noteRow" style="margin-top:8px;display:none">
            <select id="m_note" class="input"></select>
          </div>
        </div>
        <label>Beschreibung</label>
        <textarea id="m_description" class="input" rows="3" placeholder="Kurze Beschreibung oder Ritual"></textarea>
        <label>Badges</label>
        <div id="m_badgeList" class="badge-picker"></div>
      </div>
      <div class="row" style="justify-content:flex-end;margin-top:14px">
        <button class="btn" id="m_cancel">Abbrechen</button>
        <button class="btn primary" id="m_ok">OK</button>
      </div>
    </div>
  </div>

<!-- Ger√§te-Vorschau (ohne Pairing) ‚Äì ACHTUNG: SIBLING, NICHT im prevModal! -->
<div id="devPrevModal" class="modal">
  <div class="box">
    <div class="row" style="justify-content:space-between;margin-bottom:10px">
      <div style="font-weight:700" data-devprev-title>Ger√§te-Ansicht</div>
      <div class="row">
        <button class="btn sm" id="devPrevReload">Neu laden</button>
        <button class="btn sm" id="devPrevClose">Schlie√üen</button>
      </div>
    </div>
    <div class="iframeWrap">
      <iframe id="devPrevFrame" src="about:blank" loading="lazy" referrerpolicy="no-referrer"></iframe>
    </div>
    <small class="mut" style="display:block;margin-top:8px">
      Live-Ansicht des ausgew√§hlten Ger√§ts (nur Lesen; kein Pairing, keine Speicherung).
    </small>
  </div>
</div>

<div id="userModal" class="modal">
  <div class="box user-modal-box" role="dialog" aria-modal="true" aria-labelledby="userModalTitle">
    <div class="user-modal-head">
      <div>
        <h2 id="userModalTitle">Benutzer &amp; Rollen</h2>
        <p class="mut">Verwalte Konten, Zugriffsrechte und Passw√∂rter f√ºr das Admin-Interface.</p>
      </div>
      <button type="button" class="btn sm ghost" data-user-close>Schlie√üen</button>
    </div>
    <div class="user-modal-body">
      <section class="user-list-section">
        <div class="user-list-head">
          <h3>Konten</h3>
          <button type="button" class="btn sm" id="userCreateBtn">Neu</button>
        </div>
        <table class="user-table" aria-label="Benutzerliste">
          <thead>
            <tr>
              <th scope="col">Benutzer</th>
              <th scope="col">Rollen</th>
              <th scope="col">Bereiche</th>
              <th scope="col" class="user-actions-head">Aktionen</th>
            </tr>
          </thead>
          <tbody data-user-table></tbody>
        </table>
        <p class="mut user-empty" data-user-empty hidden>Keine Benutzer konfiguriert.</p>
      </section>
      <section class="user-form-section">
        <form id="userForm" class="user-form">
          <h3 data-user-form-title>Benutzer anlegen</h3>
          <div class="user-status" data-user-status role="status" aria-live="polite"></div>
          <label class="user-field">
            <span>Benutzername</span>
            <input type="text" id="userUsername" name="username" required autocomplete="username" pattern="[a-zA-Z0-9_.-]{3,}" placeholder="z.&nbsp;B. redaktion" />
          </label>
          <label class="user-field">
            <span>Anzeigename</span>
            <input type="text" id="userDisplay" name="displayName" autocomplete="name" placeholder="Optional" />
          </label>
          <fieldset class="user-field">
            <legend>Rollen</legend>
            <div class="user-role-options" data-role-options></div>
          </fieldset>
          <fieldset class="user-field">
            <legend>Bereiche</legend>
            <p class="mut user-permission-hint">Steuert, welche Module und Funktionen sichtbar sind.</p>
            <div class="user-permission-options" data-permission-options></div>
          </fieldset>
          <label class="user-field">
            <span>Passwort</span>
            <input type="password" id="userPassword" name="password" autocomplete="new-password" />
            <span class="mut user-password-hint" data-user-password-hint>Passwort wird beim Speichern gesetzt.</span>
          </label>
          <div class="user-form-actions">
            <button type="submit" class="btn primary">Speichern</button>
            <button type="button" class="btn" data-user-cancel>Zur√ºcksetzen</button>
            <button type="button" class="btn ghost" data-user-close>Schlie√üen</button>
          </div>
        </form>
      </section>
    </div>
  </div>
</div>

<script>
  (function(){
    const cockpit = document.querySelector('.workspace-overview');
    if (!cockpit) return;
    const root = document.documentElement;
    const header = document.querySelector('header');
    const resolveCockpitHeight = () => {
      if (cockpit.dataset.pinned !== 'true') return 0;
      if (cockpit.dataset.collapsed === 'true') {
        return 0;
      }
      return cockpit.offsetHeight;
    };

    const resolveHeaderMetrics = () => {
      if (!header) return { height: 0 };
      let height = header.offsetHeight || 0;
      if (typeof header.getBoundingClientRect === 'function') {
        const rect = header.getBoundingClientRect();
        if (rect && typeof rect.height === 'number') height = rect.height;
      }
      return { height};
    };

    const updateOffsets = () => {
      const { height: headerHeight } = resolveHeaderMetrics();
      const pinned = cockpit.dataset.pinned === 'true';
      const collapsed = cockpit.dataset.collapsed === 'true';
      const pinnedActive = pinned && !collapsed;
      const cockpitHeight = pinnedActive ? resolveCockpitHeight() : 0;
      const pinnedSpacing = pinnedActive ? 10 : 24;
      const workspaceBase = headerHeight + (pinnedActive ? cockpitHeight + pinnedSpacing : pinnedSpacing);
      const workspaceOffset = Math.max(112, workspaceBase);
      const stickGap = pinnedActive ? 0 : 12;
      const stickTop = Math.max(0, headerHeight + stickGap);
      const devicesOffset = headerHeight + (pinnedActive ? cockpitHeight : 0) + 8;

      root?.style.setProperty('--workspace-offset', `${workspaceOffset}px`);
      root?.style.setProperty('--cockpit-stick-top', `${stickTop}px`);
      root?.style.setProperty('--devices-offset', `${devicesOffset}px`);
      root?.style.setProperty('scroll-padding-top', `${workspaceOffset}px`);
      document.body?.style.setProperty('scroll-padding-top', `${workspaceOffset}px`);
    };

    const scheduleUpdate = () => {
      if ('requestAnimationFrame' in window) {
        window.requestAnimationFrame(updateOffsets);
      } else {
        updateOffsets();
      }
    };

    if ('ResizeObserver' in window){
      const resizeObserver = new ResizeObserver(() => scheduleUpdate());
      resizeObserver.observe(cockpit);
      if (header) resizeObserver.observe(header);
      window.addEventListener('beforeunload', () => resizeObserver.disconnect(), { once:true });
    }

    if ('MutationObserver' in window){
      const bodyObserver = new MutationObserver(() => scheduleUpdate());
      bodyObserver.observe(document.body, { attributes:true, attributeFilter:['class'] });
      window.addEventListener('beforeunload', () => bodyObserver.disconnect(), { once:true });
    }

    window.addEventListener('resize', scheduleUpdate, { passive:true });

    const resolveControls = (action) => Array.from(document.querySelectorAll(`[data-action="${action}"][data-cockpit-control]`));
    const pinButtons = resolveControls('pin');
    const toggleButtons = resolveControls('toggle');
    const toggleGroup = document.querySelector('.header-cockpit-toggle');

    let storageAvailable = true;
    try{
      const testKey = '__cockpit__';
      localStorage.setItem(testKey, '1');
      localStorage.removeItem(testKey);
    }catch(err){
      storageAvailable = false;
    }

    const load = (key) => storageAvailable ? localStorage.getItem(key) : null;
    const save = (key, value) => {
      if (!storageAvailable) return;
      if (value === null){
        localStorage.removeItem(key);
      }else{
        localStorage.setItem(key, value);
      }
    };

    const PIN_KEY = 'adminCockpitPinned';
    const COLLAPSE_KEY = 'adminCockpitCollapsed';

    const setPinState = (pinned) => {
      cockpit.dataset.pinned = pinned ? 'true' : 'false';
      pinButtons.forEach((pinBtn) => {
        pinBtn.setAttribute('aria-pressed', String(pinned));
        pinBtn.classList.toggle('is-active', pinned);
        const label = pinBtn.querySelector('[data-role="label"]');
        const icon = pinBtn.querySelector('[data-role="icon"]');
        if (label){
          const onText = label.dataset.labelPinned || label.textContent;
          const offText = label.dataset.labelUnpinned || label.textContent;
          label.textContent = pinned ? onText : offText;
        }
        if (icon){
          const onIcon = icon.dataset.iconPinned || icon.textContent;
          const offIcon = icon.dataset.iconUnpinned || icon.textContent;
          icon.textContent = pinned ? onIcon : offIcon;
        }
        const pinTitle = pinned ? 'Cockpit l√∂sen' : 'Cockpit anheften';
        pinBtn.setAttribute('title', pinTitle);
        pinBtn.setAttribute('aria-label', pinTitle);
      });
      toggleButtons.forEach((toggleBtn) => {
        toggleBtn.classList.toggle('is-pinned', pinned);
        const pinIndicator = toggleBtn.querySelector('[data-role="pin"]');
        if (pinIndicator){
          const onIcon = pinIndicator.dataset.iconPinned || pinIndicator.textContent;
          const offIcon = pinIndicator.dataset.iconUnpinned || pinIndicator.textContent;
          pinIndicator.textContent = pinned ? onIcon : offIcon;
          pinIndicator.classList.toggle('is-pinned', pinned);
        }
      });
      if (toggleGroup){
        toggleGroup.classList.toggle('is-pinned', pinned);
      }
		// Ensure sticky behavior applies even if CSS selector conflicts
      if (pinned) {
        cockpit.style.position = 'sticky';
        cockpit.style.top = 'var(--cockpit-stick-top)';
        cockpit.style.zIndex = '40';
      } else {
        cockpit.style.position = '';
        cockpit.style.top = '';
        cockpit.style.zIndex = '';
      }
      save(PIN_KEY, pinned ? '1' : null);
      scheduleUpdate();
    };

    const setCollapseState = (collapsed) => {
      cockpit.dataset.collapsed = collapsed ? 'true' : 'false';
      if (collapsed) {
        cockpit.setAttribute('aria-hidden', 'true');
      } else {
        cockpit.removeAttribute('aria-hidden');
      }
      toggleButtons.forEach((toggleBtn) => {
        toggleBtn.setAttribute('aria-expanded', String(!collapsed));
        toggleBtn.classList.toggle('is-active', !collapsed);
        const label = toggleBtn.querySelector('[data-role="label"]');
        const icon = toggleBtn.querySelector('[data-role="icon"]');
        let expandedText = 'Cockpit schlie√üen';
        let collapsedText = 'Cockpit √∂ffnen';
        if (label){
          expandedText = label.dataset.labelExpanded || expandedText;
          collapsedText = label.dataset.labelCollapsed || collapsedText;
          label.textContent = collapsed ? collapsedText : expandedText;
        }
        if (icon){
          const expandedIcon = icon.dataset.iconExpanded || icon.textContent;
          const collapsedIcon = icon.dataset.iconCollapsed || icon.textContent;
          icon.textContent = collapsed ? collapsedIcon : expandedIcon;
        }
        const expandedTitle = toggleBtn.dataset.titleExpanded || expandedText;
        const collapsedTitle = toggleBtn.dataset.titleCollapsed || collapsedText;
        const toggleTitle = collapsed ? collapsedTitle : expandedTitle;
        toggleBtn.setAttribute('title', toggleTitle);
        toggleBtn.setAttribute('aria-label', toggleTitle);
      });
      save(COLLAPSE_KEY, collapsed ? '1' : null);
      scheduleUpdate();
    };

    let pinned = load(PIN_KEY) === '1';
    let collapsed = load(COLLAPSE_KEY) === '1';

    setPinState(pinned);
    setCollapseState(collapsed);
    scheduleUpdate();

    pinButtons.forEach((pinBtn) => {
      pinBtn.addEventListener('click', () => {
        pinned = !pinned;
        setPinState(pinned);
      });
    });

    toggleButtons.forEach((toggleBtn) => {
      toggleBtn.addEventListener('click', () => {
        collapsed = !collapsed;
        setCollapseState(collapsed);
      });
    });
  })();
</script>
<script>
  (function(){
    const actionButtons = document.querySelectorAll('.workspace-card [data-jump], .workspace-card [data-view], .workspace-card [data-devices]');
    if (!actionButtons.length) return;

    const ensureDetailsOpen = (element) => {
      if (!element) return;
      if (element.matches('details')) {
        element.open = true;
      }
      let parent = element.closest('details');
      while (parent) {
        parent.open = true;
        parent = parent.parentElement?.closest('details');
      }
    };

    const getScrollTarget = (element) => {
      if (!element) return null;
      if (element.hasAttribute('data-jump-target')) {
        return element;
      }
      return element.closest('[data-jump-target]') || element;
    };

    const highlight = (element) => {
      if (!element) return;
      element.classList.remove('jump-flash');
      void element.offsetWidth;
      element.classList.add('jump-flash');
      window.setTimeout(() => element.classList.remove('jump-flash'), 1600);
    };

    const canFocus = (element) => {
      if (!(element instanceof HTMLElement)) return false;
      if (element.tabIndex >= 0) return true;
      return /^(A|BUTTON|SUMMARY|INPUT|SELECT|TEXTAREA)$/i.test(element.tagName);
    };

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    const runViewChange = async (view) => {
      if (!view) return;
      const viewHandler = window.__adminShowView || window.showView;
      if (typeof viewHandler === 'function') {
        await viewHandler(view);
        return;
      }
      const menuItem = document.querySelector(`#viewMenu .dd-item[data-view="${view}"]`);
      if (menuItem) {
        menuItem.click();
        await sleep(160);
      }
    };

    const resolveTarget = (id) => {
      if (!id) return null;
      if (id.startsWith('#')) return document.querySelector(id);
      return document.getElementById(id);
    };

    const waitForElement = async (id, attempts = 4) => {
      if (!id) return null;
      const existing = resolveTarget(id);
      if (existing) return existing;
      if (attempts <= 0) return null;
      await sleep(120);
      return waitForElement(id, attempts - 1);
    };

    actionButtons.forEach((button) => {
      button.addEventListener('click', async (event) => {
        event.preventDefault();

        const desiredView = button.dataset.view;
        if (desiredView) {
          try {
            await runViewChange(desiredView);
          } catch (error) {
            console.error('[admin] Ansicht konnte nicht gewechselt werden', error);
          }
        }

        const devicesAction = button.dataset.devices;
        if (devicesAction) {
          const devicesBtn = document.getElementById('btnDevices');
          const isActive = devicesBtn?.classList.contains('active');
          if (devicesBtn) {
            if ((devicesAction === 'open' || devicesAction === 'refresh') && !isActive) {
              devicesBtn.click();
            } else if (devicesAction === 'close' && isActive) {
              devicesBtn.click();
            } else if (devicesAction === 'toggle') {
              devicesBtn.click();
            }
          }
          if (devicesAction === 'refresh') {
            const attemptRefresh = async (tries = 4) => {
              if (typeof window.__refreshDevicesPane === 'function') {
                return window.__refreshDevicesPane({ bypassCache: true });
              }
              if (tries <= 0) return null;
              await sleep(120);
              return attemptRefresh(tries - 1);
            };
            try {
              await attemptRefresh();
            } catch (error) {
              console.error('[admin] Ger√§tebereich konnte nicht aktualisiert werden', error);
            }
          }
        }

        const targetId = button.dataset.jump;
        const highlightId = button.dataset.highlight;
        const target = await waitForElement(targetId) || await waitForElement(highlightId);
        if (!target) return;

        ensureDetailsOpen(target);

        const scrollTarget = getScrollTarget(target);
        window.requestAnimationFrame(() => {
          scrollTarget?.scrollIntoView({ behavior: 'smooth', block: 'start' });
          const highlightEl = target.matches('details')
            ? target.querySelector(':scope > summary') || scrollTarget
            : scrollTarget;
          highlight(highlightEl);
          if (highlightEl && typeof highlightEl.focus === 'function' && canFocus(highlightEl)) {
            highlightEl.focus({ preventScroll: true });
          }
        });
      });
    });
  })();
</script>
<script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script>
  (function bootstrapAdminApp() {
    var manifestUrl = '/admin/dist/manifest.json';
    var head = document.head || document.getElementsByTagName('head')[0];

    function showBootstrapError(message) {
      var container = document.createElement('div');
      container.setAttribute('role', 'alert');
      container.style.margin = '16px';
      container.style.padding = '12px 16px';
      container.style.background = 'rgba(220, 53, 69, 0.12)';
      container.style.border = '1px solid rgba(220, 53, 69, 0.35)';
      container.style.borderRadius = '8px';
      container.style.color = '#7a1b1b';
      container.style.fontWeight = '600';
      container.style.textAlign = 'center';
      container.textContent = message;
      document.body.insertBefore(container, document.body.firstChild);
    }

    fetch(manifestUrl, { cache: 'no-cache' })
      .then(function (response) {
        if (!response.ok) {
          throw new Error('Manifest konnte nicht geladen werden: ' + response.status + ' ' + response.statusText);
        }
        return response.json();
      })
      .then(function (manifest) {
        var entry = manifest['webroot/admin/js/app.js'];
        if (!entry || !entry.file) {
          throw new Error('Manifest enth√§lt keinen g√ºltigen Eintrag f√ºr die Admin-App.');
        }

        if (Array.isArray(entry.css)) {
          entry.css.forEach(function (cssFile) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '/admin/dist/' + cssFile;
            head.appendChild(link);
          });
        }

        var script = document.createElement('script');
        script.type = 'module';
        script.src = '/admin/dist/' + entry.file;
        script.onerror = function () {
          showBootstrapError('Fehler beim Laden der Admin-Oberfl√§che. Bitte die Seite neu laden oder den Support kontaktieren.');
        };
        head.appendChild(script);
      })
      .catch(function (error) {
        console.error('Admin-Bootstrap fehlgeschlagen:', error);
        showBootstrapError('Die Admin-Oberfl√§che konnte nicht automatisch initialisiert werden. Bitte Seite neu laden oder Support kontaktieren.');
      });
  })();
</script>
</body>
</html>
