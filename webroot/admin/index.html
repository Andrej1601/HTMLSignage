 <!doctype html> <html lang="de"> <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aufguss ‚Äì Admin</title>
<link rel="stylesheet" href="/admin/css/admin.css">

</head>
<body class="theme-light">
  <div class="admin-shell">
    <aside class="shell-sidebar" aria-label="Hauptnavigation">
      <div class="sidebar-brand">
        <span class="sidebar-logo" aria-hidden="true">‚ô®Ô∏è</span>
        <div class="sidebar-brand-text">
          <span class="sidebar-brand-title">Anzeigensteuerung</span>
          <span class="sidebar-brand-sub">Admin-Cockpit</span>
        </div>
      </div>
      <div class="sidebar-section">
        <p class="sidebar-section-label">Arbeitsbereiche</p>
        <nav class="sidebar-nav" aria-label="Arbeitsbereiche" data-shell-menu>
          <div class="sidebar-nav-group" data-shell-group>
            <button type="button" class="sidebar-nav-btn" data-shell-trigger>
              <span class="sidebar-nav-label"><span aria-hidden="true">üñ•Ô∏è</span> Live-Monitoring</span>
              <span class="sidebar-nav-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="sidebar-submenu" data-shell-submenu>
              <button type="button" class="sidebar-submenu-btn" data-panel="monitoring" data-focus="#dockPane">Vorschau</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="monitoring" data-focus="#devicesPane">Ger√§te√ºbersicht</button>
            </div>
          </div>
          <div class="sidebar-nav-group" data-shell-group>
            <button type="button" class="sidebar-nav-btn" data-shell-trigger>
              <span class="sidebar-nav-label"><span aria-hidden="true">üóìÔ∏è</span> Tagesplanung</span>
              <span class="sidebar-nav-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="sidebar-submenu" data-shell-submenu>
              <button type="button" class="sidebar-submenu-btn" data-panel="planning" data-focus="#gridPane">Plan bearbeiten</button>
            </div>
          </div>
          <div class="sidebar-nav-group" data-shell-group>
            <button type="button" class="sidebar-nav-btn" data-shell-trigger>
              <span class="sidebar-nav-label"><span aria-hidden="true">üî•</span> Standorte &amp; Hinweise</span>
              <span class="sidebar-nav-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="sidebar-submenu" data-shell-submenu>
              <button type="button" class="sidebar-submenu-btn" data-panel="saunas" data-focus="#boxSaunas">Saunen &amp; √úbersicht</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="saunas" data-focus="#boxFootnotes">Fu√ünoten &amp; Badges</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="saunas" data-focus="#badgeLibrarySection">Badge-Bibliothek</button>
            </div>
          </div>
          <div class="sidebar-nav-group" data-shell-group>
            <button type="button" class="sidebar-nav-btn" data-shell-trigger>
              <span class="sidebar-nav-label"><span aria-hidden="true">üé¨</span> Automationen &amp; Ablauf</span>
              <span class="sidebar-nav-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="sidebar-submenu" data-shell-submenu>
              <button type="button" class="sidebar-submenu-btn" data-panel="slides" data-focus="#slidesMaster">Slides ‚Äì Ablauf</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="slides" data-focus="#slidesFlowCard">Zeitsteuerung</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="slides" data-focus="#slidesAutomationCard">Automatisierung</button>
            </div>
          </div>
          <div class="sidebar-nav-group" data-shell-group>
            <button type="button" class="sidebar-nav-btn" data-shell-trigger>
              <span class="sidebar-nav-label"><span aria-hidden="true">üñºÔ∏è</span> Storytelling &amp; Infos</span>
              <span class="sidebar-nav-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="sidebar-submenu" data-shell-submenu>
              <button type="button" class="sidebar-submenu-btn" data-panel="stories" data-focus="#boxStories">Zusatzinfos</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="stories" data-focus="#infoWellness">Wellness-Tipps</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="stories" data-focus="#infoEvents">Event-Countdowns</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="stories" data-focus="#infoGastro">Gastro-Infos</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="stories" data-focus="#infoHero">Hero-Timeline</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="stories" data-focus="#infoStories">Story-Slides</button>
            </div>
          </div>
          <div class="sidebar-nav-group" data-shell-group>
            <button type="button" class="sidebar-nav-btn" data-shell-trigger>
              <span class="sidebar-nav-label"><span aria-hidden="true">üé®</span> Designsystem &amp; Medien</span>
              <span class="sidebar-nav-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="sidebar-submenu" data-shell-submenu>
              <button type="button" class="sidebar-submenu-btn" data-panel="media" data-focus="#boxImages">Medien-Slides</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="media" data-focus="#boxSlidesText">Slideshow &amp; Text</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="media" data-focus="#displayLayoutFold">Layout &amp; Darstellung</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="media" data-focus="#styleSetControls">Style-Paletten</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="media" data-focus="#colorsOverview">Farben</button>
              <button type="button" class="sidebar-submenu-btn" data-panel="media" data-focus="#systemSettings">System &amp; Import</button>
            </div>
          </div>
        </nav>
      </div>
      <div class="sidebar-section sidebar-support">
        <p class="sidebar-section-label">Support</p>
        <p class="sidebar-support-text">Hilfe, Tastenk√ºrzel und Dokumentation f√ºr Redaktionsteams.</p>
        <button type="button" class="btn ghost sidebar-help-btn" id="btnHelp">Hilfe √∂ffnen</button>
      </div>
    </aside>
    <div class="shell-overlay" data-role="sidebar-overlay" aria-hidden="true"></div>
    <div class="shell-main">
      <header>
        <div class="header-top">
          <div class="header-title">
            <button type="button" class="nav-toggle" id="navToggle" aria-label="Navigation ein- oder ausblenden" aria-expanded="false">‚ò∞</button>
            <div class="header-title-text">
              <span class="header-eyebrow">Admin-Cockpit</span>
              <h1>Anzeigensteuerung</h1>
              <p class="header-subtitle">Kuratiere Inhalte, plane Aufg√ºsse und behalte Displays jederzeit im Blick.</p>
            </div>
          </div>
          <label class="toggle" title="Hell/Dunkel">
            <input type="checkbox" id="themeMode">
            <svg class="sun" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="4" fill="currentColor"/>
              <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <line x1="12" y1="2" x2="12" y2="4"/>
                <line x1="12" y1="20" x2="12" y2="22"/>
                <line x1="4.93" y1="4.93" x2="6.34" y2="6.34"/>
                <line x1="17.66" y1="17.66" x2="19.07" y2="19.07"/>
                <line x1="2" y1="12" x2="4" y2="12"/>
                <line x1="20" y1="12" x2="22" y2="12"/>
                <line x1="4.93" y1="19.07" x2="6.34" y2="17.66"/>
                <line x1="17.66" y1="6.34" x2="19.07" y2="4.93"/>
              </g>
            </svg>
            <svg class="moon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"/>
            </svg>
          </label>
        </div>
        <div class="header-actions">
          <div class="header-actions-left">
            <span class="help-anchor" data-help-key="devices-panel">
              <button class="btn" id="btnDevices">Ger√§te</button>
            </span>
            <div class="menuwrap" id="viewMenuWrap" data-help-key="view-menu">
              <button class="btn" id="viewMenuBtn" aria-haspopup="menu" aria-expanded="false">
                Ansicht: <span id="viewMenuLabel">Grid</span> ‚ñæ
              </button>
              <div class="dropdown" id="viewMenu" role="menu" hidden>
                <button class="dd-item" role="menuitemradio" data-view="grid" aria-checked="true">‚ñ¶ Grid</button>
                <button class="dd-item" role="menuitemradio" data-view="preview" aria-checked="false">‚ñ∂ Vorschau</button>
              </div>
            </div>
          </div>
          <div class="header-actions-right">
            <button class="btn" id="btnOpen">Slideshow √∂ffnen</button>
            <span class="help-anchor" data-help-key="save">
              <button class="btn primary" id="btnSave">Speichern</button>
            </span>
            <span id="unsavedBadge" class="unsaved-badge" hidden role="status" aria-live="polite">
              <span class="unsaved-badge-text">√Ñnderungen nicht gespeichert</span>
              <button type="button" class="unsaved-badge-btn" id="unsavedBadgeReset" aria-label="√Ñnderungen verwerfen">‚ü≥</button>
            </span>
          </div>
        </div>
      </header>

      <main class="layout">
    

    <section class="workspace-panels" id="workspacePanels" aria-live="polite" data-help-key="shell-workspace">
      <div class="workspace-panel" data-panel="monitoring">
        <div class="panel-stack">
          <div class="panel-slot" id="previewPaneHost" aria-live="polite">
            <div class="panel-placeholder">
              <h2>Vorschau</h2>
              <p>Nutze ‚ÄûVorschau‚Äú im Men√º, um eine Live-Ansicht der Slides zu laden.</p>
            </div>
          </div>
          <div class="panel-slot" id="devicesPaneHost" aria-live="polite">
            <div class="panel-placeholder">
              <h2>Ger√§te√ºbersicht</h2>
              <p>Die gekoppelte Ger√§teverwaltung erscheint hier, sobald sie angeheftet ist.</p>
            </div>
          </div>
        </div>
      </div>
      <div class="workspace-panel is-active" data-panel="planning">
        <div class="card" id="gridPane" data-jump-target data-help-key="schedule">
          <div class="content" style="padding-bottom:0">
<div class="row" id="planHead" style="justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;flex-wrap:wrap">
  <div style="font-weight:700">Aufgussplan <span class="mut">(<span id="activeDayLabel">‚Äî</span>)</span></div>
  <div id="gridActionsLeft" class="row" style="gap:6px">
    <button class="btn sm" id="btnUndo" title="R√ºckg√§ngig" disabled>‚Ü∂ R√ºckg√§ngig</button>
    <button class="btn sm" id="btnRedo" title="Wiederholen" disabled>‚Ü∑ Wiederholen</button>
  </div>
<div class="row" style="gap:8px;flex-wrap:wrap">
    <div id="weekdayPills" class="row" style="gap:6px"></div>
    <button class="btn sm" id="btnSavePreset" title="Wochentag speichern">üíæ Wochentag speichern</button>
    <span class="mut">Ausgew√§hlte Zeit:</span> <span id="selTime" style="font-weight:700">‚Äî</span>
  </div>
</div>
          <table id="grid" class="tbl"></table>
          <div class="row" style="margin:12px 0 4px">
            <button class="btn sm" id="btnAddAbove">Zeile dar√ºber +</button>
            <button class="btn sm" id="btnAddBelow">Zeile darunter +</button>
            <button class="btn sm" id="btnDeleteRow">Ausgew√§hlte Zeile l√∂schen</button>
            <span class="mut">Zeit anklicken = Zeile markieren ¬∑ Zeit√§nderungen im Dialog verschieben Aufguss korrekt.</span>
          </div>
          </div>
        </div>
      </div>
      <div class="workspace-panel" data-panel="slides">
<!-- Slides ‚Äì Masterbox -->
<details class="ac full" open id="slidesMaster" data-jump-target>
  <summary>
    <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Slides ‚Äì Reihenfolge, Sichtbarkeit & Zeiten</div>
    <div class="actions">
      <button class="btn sm ghost" id="resetTiming">Standardwerte</button>
    </div>
  </summary>
  <div class="content">
    <div class="settings-stack">
      <div class="settings-card" id="slidesFlowCard" data-jump-target>
        <div class="settings-card-head">
          <div class="settings-card-title">Ablauf &amp; Zeitsteuerung</div>
          <p class="settings-card-description">Bestimme Dauer, √úberg√§nge und Verhalten beim Abspielen.</p>
        </div>
        <div class="settings-card-body">
          <!-- Dauer-Modus (global, gilt f√ºr Saunen + Bilder) -->
          <div class="kv" id="rowDurMode">
            <label>Dauer-Modus <span class="tip" title="Bestimmt, ob alle Slides dieselbe Dauer haben oder individuell gesteuert werden.">‚ùî</span></label>
            <div class="row">
              <label class="btn sm ghost" style="gap:6px"><input type="radio" name="durMode" id="durUniform" value="uniform"> Einheitlich</label>
              <label class="btn sm ghost" style="gap:6px"><input type="radio" name="durMode" id="durPer" value="per"> Individuell pro Slide</label>
            </div>
          </div>

          <div class="kv" id="rowDwellAll">
            <label>Dauer (einheitlich)</label>
            <div class="row" style="gap:8px;align-items:center;flex-wrap:wrap">
              <span class="mut" style="min-width:14ch;">alle au√üer √úbersicht</span>
              <input id="dwellAll" class="input num3" type="number" min="1" max="120" step="1" />

              <span class="mut" style="min-width:10ch;">√úbersicht</span>
              <input id="ovSecGlobal" class="input num3" type="number" min="1" max="120" step="1" />
            </div>
          </div>

          <!-- Transition -->
          <div class="kv">
            <label>Transition (ms)</label>
            <input id="transMs2" class="input" type="number" min="0" value="500">
          </div>

          <div class="kv">
            <label>Weiter erst nach Video-Ende</label>
            <input id="waitForVideo" type="checkbox">
          </div>
        </div>
      </div>

      <div class="settings-card" id="slidesAutomationCard" data-jump-target>
        <div class="settings-card-head">
          <div class="settings-card-title">Automatisierung</div>
          <p class="settings-card-description">L√§dt zu Start oder Tab-Wechsel automatisch passende Voreinstellungen.</p>
        </div>
        <details class="settings-card-body style-auto-fold" id="styleAutomationFold" open>
          <summary class="style-auto-summary">
            <span class="style-auto-summary-text">Automatisierung konfigurieren</span>
            <span class="style-auto-summary-chev" aria-hidden="true">‚ñæ</span>
          </summary>
          <div class="style-auto-inner">
            <div class="kv">
              <label>Auto je Wochentag <span class="tip" title="L√§dt beim Start automatisch das Preset des aktuellen Wochentags.">‚ùî</span></label>
              <input id="presetAuto" type="checkbox">
            </div>
            <div class="help">Wenn aktiv, wird beim √ñffnen und beim Wechsel des Tabs automatisch das Preset des aktuellen Wochentags geladen (falls vorhanden).</div>
            <div class="divider"></div>
            <div class="kv">
              <label>Style-Automation aktiv</label>
              <input id="styleAutoEnabled" type="checkbox">
            </div>
            <div class="kv">
              <label>Fallback-Stil</label>
              <select id="styleAutoFallback" class="input"></select>
            </div>
            <div class="style-auto-list" id="styleAutoList"></div>
            <div class="row style-auto-actions">
              <button class="btn sm" id="styleAutoAdd">Zeitfenster hinzuf√ºgen</button>
            </div>
          </div>
        </details>
      </div>
      </div>
      <div class="workspace-panel" data-panel="saunas">

    <!-- Unterbox 1: Saunen & √úbersicht -->
    <details class="ac sub" open id="boxSaunas" data-jump-target>
      <summary><div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Saunen & √úbersicht</div>
 <div class="actions"><button class="btn sm" id="btnAddSauna">Sauna hinzuf√ºgen</button></div>
</summary>      
<div class="content">

        <!-- √úbersicht im Saunen-Stil -->
        <div class="fieldset" style="margin-bottom:10px">
          <div class="legend">√úbersicht (Aufgussplan)</div>
          <div id="overviewRow"></div>
        </div>

        <!-- Saunenliste -->
		<!-- Kopf f√ºr den Bereich "Aufguss" + 2. Wochentags-Pillen -->
<div class="groupHead">
  <div class="legend">Aufguss</div>
  <div id="weekdayPills2" class="day-pills row" style="gap:6px"></div>
</div>
 	<!-- Aufguss -->
<div class="sl-head sl-saunas">
  <span class="col-name">Name</span>
  <span class="col-prev">Preview</span>
  <span class="col-dur" id="headSaunaDur">Dauer (s)*</span>
  <span class="col-up">Upload</span>
  <span class="col-def">Default</span>
  <span class="col-del">‚úï</span>
  <span class="col-vis">Anzeigen</span>
</div>
        
	<!-- kein Aufguss -->
	<div id="saunaList"></div>
	<div class="subh" id="extraTitle" style="display:none">Heute kein Aufguss</div>
        <div id="extraSaunaList"></div>

        <div class="help" style="margin-top:6px">* Dauer nur sichtbar, wenn ‚ÄûIndividuell‚Äú gew√§hlt ist.</div>
      </div>
    </details>

    <!-- Unterbox 2: Fu√ünoten & Badges -->
    <details class="ac sub" id="boxFootnotes" data-jump-target>
  <summary>
    <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Fu√ünoten &amp; Badges</div>
    <div class="actions"><button class="btn sm" id="fnAdd">Fu√ünote hinzuf√ºgen</button></div>
  </summary>
  <div class="content">
    <div class="footnote-section" id="footnoteSection" data-jump-target>
      <div class="footnote-header">
        <button class="footnote-toggle" type="button" id="footnoteToggle" aria-expanded="false" aria-controls="footnoteBody">Fu√ünoten verwalten</button>
      </div>
      <div class="footnote-body" id="footnoteBody" aria-hidden="true">
        <div class="footnote-body-inner">
          <div id="fnList"></div>
        </div>
      </div>
    </div>
    <div class="subh">Darstellung</div>
    <div class="kv">
      <label>Fu√ünoten-Layout <span class="tip" title="Legt fest, wie mehrere Fu√ünoten dargestellt werden.">‚ùî</span></label>
      <select id="footnoteLayout" class="input">
        <option value="one-line" selected>M√∂glichst einzeilig</option>
        <option value="multi">Mehrzeilig</option>
        <option value="stacked">Untereinander (jede Zeile)</option>
      </select>
    </div>
    <div class="badge-lib-section" id="badgeLibrarySection" data-jump-target>
      <div class="badge-lib-header">
        <button class="badge-lib-toggle" type="button" id="badgeLibraryToggle" aria-expanded="false" aria-controls="badgeLibraryBody">Badge-Bibliothek</button>
        <button class="btn sm" id="badgeAdd" type="button">Badge hinzuf√ºgen</button>
      </div>
      <div class="badge-lib-body" id="badgeLibraryBody" aria-hidden="true">
        <div class="badge-lib-body-inner">
          <div class="badge-lib-tools" id="badgeEmojiTools">
            <div class="badge-lib-tools-head">
              <div class="badge-lib-tools-title">Emoji-Auswahl</div>
              <div class="badge-lib-tools-text">W√§hle ein Emoji aus der Liste oder erg√§nze eigene Favoriten f√ºr die Badges.</div>
            </div>
            <div class="badge-lib-tools-body">
              <div class="badge-lib-emoji-add">
                <input id="badgeEmojiInput" class="input" type="text" maxlength="8" placeholder="Emoji einf√ºgen" aria-label="Eigenes Emoji">
                <button class="btn sm" id="badgeEmojiAdd" type="button" disabled>Emoji hinzuf√ºgen</button>
              </div>
              <div class="badge-lib-emoji-list" id="badgeEmojiCustom" aria-live="polite"></div>
            </div>
          </div>
          <div id="badgeLibraryList" class="badge-library-list"></div>
          <div class="help">Verwalte Emoji, Bild und Label der ausw√§hlbaren Badges f√ºr Aufg√ºsse.</div>
        </div>
      </div>
    </div>
  </div>
</details>
      </div>
      <div class="workspace-panel" data-panel="stories">

    <!-- Unterbox 4: Globale Zusatzinhalte & Informationen -->
    <details class="ac sub" id="boxStories" data-jump-target>
      <summary>
        <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Global Zusatzinhalte &amp; Informationen</div>
      </summary>
      <div class="content global-info-pane">
        <div class="global-info-sections">
          <details class="info-fold" id="infoWellness" open data-jump-target>
            <summary>Wellness-Tipps</summary>
            <div class="info-fold-body">
              <div class="extras-group" id="extrasWellness">
                <div class="extras-group-head">
                  <div class="extras-group-title">Wellness-Tipps</div>
                  <button class="btn sm" id="extrasWellnessAdd">Tipp hinzuf√ºgen</button>
                </div>
                <div class="extras-group-list" id="extrasWellnessList"></div>
              </div>
            </div>
          </details>
          <details class="info-fold" id="infoEvents" open data-jump-target>
            <summary>Event-Countdowns</summary>
            <div class="info-fold-body">
              <div class="extras-group" id="extrasEvents">
                <div class="extras-group-head">
                  <div class="extras-group-title">Event-Countdowns</div>
                  <button class="btn sm" id="extrasEventAdd">Event hinzuf√ºgen</button>
                </div>
                <div class="extras-group-list" id="extrasEventList"></div>
                <div class="help">Datums- und Zeitangabe im lokalen Format, z.&nbsp;B. 2024-12-24T20:00.</div>
              </div>
            </div>
          </details>
          <details class="info-fold" id="infoGastro" open data-jump-target>
            <summary>Gastro-Infos</summary>
            <div class="info-fold-body">
              <div class="extras-group" id="extrasGastro">
                <div class="extras-group-head">
                  <div class="extras-group-title">Gastronomie-Highlights</div>
                  <button class="btn sm" id="extrasGastroAdd">Highlight hinzuf√ºgen</button>
                </div>
                <div class="extras-group-list" id="extrasGastroList"></div>
              </div>
            </div>
          </details>
          <details class="info-fold" id="infoHero" data-jump-target>
            <summary>Hero-Timeline</summary>
            <div class="info-fold-body hero-fold-body">
              <div class="kv">
                <label class="row" style="gap:8px;align-items:center">
                  <input id="heroTimelineEnabled" type="checkbox">
                  <span>Hero-Timeline anzeigen</span>
                </label>
              </div>
              <div class="kv" id="heroTimelineSettings" hidden>
                <label>Einstellungen</label>
                <div class="row" style="gap:8px;align-items:center;flex-wrap:wrap">
                  <span class="mut">Dauer (s)</span>
                  <input id="heroTimelineDuration" class="input num3" type="number" min="1" max="120" step="1">
                  <span class="mut">Basis-Minuten</span>
                  <input id="heroTimelineBase" class="input num3" type="number" min="1" max="120" step="1">
                  <span class="mut">Max. Eintr√§ge</span>
                  <input id="heroTimelineMax" class="input num3" type="number" min="1" max="50" step="1" placeholder="leer = alle">
                </div>
              </div>
            </div>
          </details>
          <details class="info-fold" id="infoStories" data-jump-target>
            <summary>Story-Slides</summary>
            <div class="info-fold-body story-fold-body">
              <div class="info-fold-actions"><button class="btn sm" id="btnStoryAdd">Information hinzuf√ºgen</button></div>
              <div class="story-builder-pane">
                <div class="subh">Informationen</div>
                <div class="help">Pflege Texte, Bilder und Layout f√ºr erkl√§rende Slides in einem flexiblen Spalten-Baukasten.</div>
                <div class="story-builder" id="storyBuilder">
                  <div class="story-builder-list" id="storyList"></div>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </details>
      </div>
      <div class="workspace-panel" data-panel="media">

    <!-- Unterbox 4: Medien-Slides -->
    <details class="ac sub" id="boxImages" data-jump-target>
<summary>
    <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Medien-Slides</div>
    <div class="actions"><button class="btn sm" id="btnMediaAdd">Medien hinzuf√ºgen</button></div>
  </summary>
<small class="help">* Dauer nur sichtbar, wenn ‚ÄûIndividuell pro Slide‚Äú gew√§hlt ist.</small>
  <div class="content">
<div class="sl-head sl-images">
    <span class="col-name">Name</span>
    <span class="col-type">Typ</span>
    <span class="col-prev">Preview</span>
    <span class="col-dur" id="headImgDur">Dauer (s)</span>
    <span class="col-up">Upload</span>
    <span class="col-del">‚úï</span>
    <span class="col-vis">Anzeigen</span>
  </div>
    <div id="interList2"></div>
  </div>
</details>

  </div>
</details>

 <details class="ac full" id="boxSlidesText" data-jump-target>
        <summary>
          <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Slideshow & Text</div>
          <div class="actions"><button class="btn sm ghost" id="resetSlides">Standardwerte</button></div>
        </summary>
        <div class="content">
          <div class="layout-display-block">
            <details class="layout-display-fold" id="displayLayoutFold" open data-jump-target>
              <summary class="layout-display-summary">
                <span class="layout-display-summary-text">
                  <span class="layout-display-summary-title">Darstellung &amp; Seiten</span>
                  <span class="layout-display-summary-sub">Einspaltig oder Zweispaltig konfigurieren</span>
                </span>
                <span class="layout-display-chev" aria-hidden="true">‚ñæ</span>
              </summary>
              <div class="layout-display-body">
                <div class="kv">
                  <label>Darstellung</label>
                  <select id="layoutMode" class="input">
                    <option value="single">Einspaltig</option>
                    <option value="split">Zweispaltig</option>
                  </select>
                </div>
                <div class="kv">
                  <label>Layout-Profil</label>
                  <select id="layoutProfile" class="input">
                    <option value="landscape">Standard (16:9)</option>
                    <option value="portrait">Portrait ‚Äì Einzel</option>
                    <option value="portrait-split">Portrait ‚Äì geteilte Bereiche</option>
                    <option value="triple">Triple-Column</option>
                    <option value="asymmetric">Asymmetrisch</option>
                  </select>
                </div>
                <div class="layout-display-columns">
                  <div class="fieldset layout-page" id="layoutLeft">
                    <div class="legend">Linke Seite</div>
                    <div class="kv">
                      <label>Timer (Sekunden)</label>
                      <input id="pageLeftTimer" class="input num3" type="number" min="0" max="600" step="1" placeholder="0 = global">
                    </div>
                    <div class="kv">
                      <label>Playlist</label>
                      <div class="playlist-selector" id="pageLeftPlaylist"></div>
                      <div class="help">Klicken zum (De-)Aktivieren, Pfeile oder Ziehen f√ºr die Reihenfolge. Eine leere Playlist nutzt den Standardfilter.</div>
                    </div>
                  </div>
                  <div class="fieldset layout-page" id="layoutRight">
                    <div class="legend">Rechte Seite</div>
                    <div class="kv">
                      <label>Timer (Sekunden)</label>
                      <input id="pageRightTimer" class="input num3" type="number" min="0" max="600" step="1" placeholder="0 = global">
                    </div>
                    <div class="kv">
                      <label>Playlist</label>
                      <div class="playlist-selector" id="pageRightPlaylist"></div>
                      <div class="help">Klicken zum (De-)Aktivieren, Pfeile oder Ziehen f√ºr die Reihenfolge.</div>
                    </div>
                    <div class="help">Wird verwendet, wenn das Zweispalten-Layout aktiv ist.</div>
                  </div>
                </div>
              </div>
            </details>
          </div>
          <div class="settings-grid two-col">
            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">Style Paletten</div>
              </div>
              <div class="settings-card-body">
                <div class="kv">
                  <label>Stil-Paletten</label>
                  <div class="style-set-controls" id="styleSetControls" data-jump-target>
                    <select id="styleSetSelect" class="input"></select>
                    <div class="row" style="gap:6px;flex-wrap:wrap">
                      <button class="btn sm" id="styleSetApply" type="button">Aktivieren</button>
                      <button class="btn sm ghost" id="styleSetSave" type="button">Aktualisieren</button>
                      <button class="btn sm ghost" id="styleSetCreate" type="button">Neu</button>
                      <button class="btn sm ghost" id="styleSetDelete" type="button">L√∂schen</button>
                    </div>
                  </div>
                </div>
                <div class="kv"><label>Palettenname</label><input id="styleSetLabel" class="input" type="text" placeholder="Palette"></div>
                <div class="help">Paletten speichern Farben, Typografie und Badge-Optionen. ‚ÄûAktivieren‚Äú √ºbernimmt die Auswahl in die aktuellen Einstellungen.</div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">Typografie ‚Äì Basis</div>
              </div>
              <div class="settings-card-body">
                <div class="kv"><label>Schriftfamilie</label>
                  <select id="fontFamily" class="input">
                    <option value="system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans, Ubuntu, Cantarell, 'Helvetica Neue',sans-serif">System (Default)</option>
                    <option value="Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif">Montserrat</option>
                    <option value="Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif">Roboto</option>
                    <option value="'Open Sans', system-ui, -apple-system, Segoe UI, Arial, sans-serif">Open Sans</option>
                    <option value="Lato, system-ui, -apple-system, Segoe UI, Arial, sans-serif">Lato</option>
                  </select>
                </div>
                <div class="kv"><label>Globaler Scale</label><input id="fontScale" class="input" type="number" step="0.05" min="0.5" max="3" value="1"></div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">Typografie ‚Äì √úberschriften</div>
              </div>
              <div class="settings-card-body">
                <div class="kv"><label>H1 Scale</label><input id="h1Scale" class="input" type="number" step="0.05" min="0.5" max="3.5" value="1"></div>
                <div class="kv"><label>H2 Scale</label><input id="h2Scale" class="input" type="number" step="0.05" min="0.5" max="3.5" value="1"></div>
                <div class="kv"><label>H2 Modus</label>
                  <select id="h2Mode" class="input">
                    <option value="none">‚Äî nichts ‚Äî</option>
                    <option value="text" selected>Nur Text</option>
                    <option value="weekday">Wochentag</option>
                    <option value="date">Datum</option>
                    <option value="text+weekday">Text + Wochentag</option>
                    <option value="text+date">Text + Datum</option>
                  </select>
                </div>
                <div class="kv"><label>H2 Text</label><input id="h2Text" class="input" type="text" placeholder="Aufgusszeiten"></div>
                <div class="kv"><label>H2 in √úbersicht anzeigen</label><input id="h2ShowOverview" type="checkbox" checked></div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">√úbersicht (Tabelle)</div>
              </div>
              <div class="settings-card-body">
                <div class="kv"><label>√úbersichtstitel Scale</label><input id="ovTitleScale" class="input" type="number" step="0.05" min="0.4" max="4" value="1"></div>
                <div class="kv"><label>Kopf‚ÄëScale</label><input id="ovHeadScale" class="input" type="number" step="0.05" min="0.5" max="3" value="0.9"></div>
                <div class="kv"><label>Zellen‚ÄëScale</label><input id="ovCellScale" class="input" type="number" step="0.05" min="0.5" max="3" value="0.8"></div>
                <div class="kv"><label>Zeitspaltenbreite (ch)</label><input id="ovTimeWidth" class="input" type="number" step="0.5" min="6" max="24" value="10"></div>
                <div class="kv"><label>Chip‚ÄëH√∂he (%)</label><input id="chipH" class="input" type="number" min="50" max="200" value="100"></div>
                <div class="help">Chips sind immer gleich breit/hoch (f√ºllen die Zelle) und zentriert.</div>
                <div class="kv"><label>Text√ºberl√§nge</label>
                  <select id="chipOverflowMode" class="input">
                    <option value="scale" selected>Automatisch skalieren</option>
                    <option value="ellipsis">Mit ‚Äû‚Ä¶‚Äú k√ºrzen</option>
                  </select>
                </div>
                <div class="kv"><label>Flammen anzeigen</label><input id="overviewFlames" type="checkbox" checked></div>
                <div class="kv"><label>Flammen-Gr√∂√üe (% der Chip-H√∂he)</label>
                  <input id="flamePct" class="input" type="number" min="30" max="100" value="55">
                </div>
                <div class="kv"><label>Flammen-Abstand (Faktor)</label>
                  <input id="flameGap" class="input" type="number" min="0" max="1" step="0.01" value="0.14">
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">Saunafolien &amp; Komponenten</div>
              </div>
              <div class="settings-card-body">
                <div class="kv"><label>Text‚ÄëScale</label><input id="tileTextScale" class="input" type="number" step="0.05" min="0.5" max="3" value="0.8"></div>
                <div class="kv"><label>Font‚ÄëWeight</label>
                  <select id="tileWeight" class="input">
                    <option value="400">Normal (400)</option>
                    <option value="500">Medium (500)</option>
                    <option value="600" selected>Semibold (600)</option>
                    <option value="700">Bold (700)</option>
                    <option value="800">Extra Bold (800)</option>
                  </select>
                </div>
                <div class="kv"><label>Uhrzeit Scale</label><input id="tileTimeScale" class="input" type="number" step="0.05" min="0.5" max="2" value="1"></div>
                <div class="kv"><label>‚ÄûUhr‚Äú hinter Uhrzeiten anzeigen</label><input id="timeSuffixToggle" type="checkbox"></div>
                <div class="kv"><label>Flammen in Kacheln anzeigen</label><input id="saunaFlames" type="checkbox" checked></div>
                <div class="kv"><label>Flammen-Gr√∂√üe (Faktor)</label><input id="tileFlameSizeScale" class="input" type="number" step="0.05" min="0.4" max="3" value="1"></div>
                <div class="kv"><label>Flammen-Abstand (Faktor)</label><input id="tileFlameGapScale" class="input" type="number" step="0.05" min="0" max="3" value="1"></div>
                <div class="kv"><label>Badge-Scale (Faktor)</label><input id="badgeScale" class="input" type="number" step="0.05" min="0.3" max="3" value="1"></div>
                <div class="kv"><label>Beschreibung-Scale (Faktor)</label><input id="badgeDescriptionScale" class="input" type="number" step="0.05" min="0.3" max="3" value="1"></div>
                <div class="kv"><label>Badges neben Aufguss anzeigen</label><input id="badgeInlineColumn" type="checkbox"></div>
                <div class="kv"><label>Kachel‚ÄëBreite % (sichtbarer Bereich)</label><input id="tilePct" class="input" type="number" min="1" max="100" value="45"></div>
                <div class="kv"><label>Kachel‚ÄëBreite min (Faktor)</label><input id="tileMin" class="input" type="number" min="0" max="1" step="0.01" value="0.25"></div>
                <div class="kv"><label>Kachel‚ÄëBreite max (Faktor)</label><input id="tileMax" class="input" type="number" min="0" max="1" step="0.01" value="0.57"></div>
                <div class="kv"><label>H1 Max-Breite (%)</label><input id="saunaHeadingWidth" class="input" type="number" min="10" max="100" value="100"></div>
                <div class="kv"><label>Kachel-H√∂hen-Scale</label><input id="tileHeightScale" class="input" type="number" step="0.05" min="0.5" max="2" value="1"></div>
                <div class="kv"><label>Innenabstand (Faktor)</label><input id="tilePaddingScale" class="input" type="number" step="0.05" min="0.25" max="1.5" value="0.75"></div>
                <div class="kv"><label>Badge-Farbe</label>
                  <input id="badgeColor" class="input" type="color" value="#5C3101" title="Badge-Farbe">
                </div>
                <div class="kv"><label>Farbverlauf anzeigen</label><input id="tileOverlayEnabled" type="checkbox" checked></div>
                <div class="kv"><label>Farbverlauf-St√§rke (%)</label><input id="tileOverlayStrength" class="input" type="number" step="5" min="0" max="200" value="100"></div>
                <div class="kv">
                  <label>Komponenten auf Slides</label>
                  <div id="componentToggleWrap" class="component-toggle-wrap">
                    <label class="btn sm ghost component-toggle"><input type="checkbox" data-component="title"> Titel &amp; Uhrzeit</label>
                    <label class="btn sm ghost component-toggle"><input type="checkbox" data-component="description"> Beschreibung</label>
                    <label class="btn sm ghost component-toggle"><input type="checkbox" data-component="badges"> Badge-Leiste</label>
                  </div>
                  <div class="help">Gilt auch f√ºr die Verf√ºgbarkeitsliste in Story-Slides.</div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">Bildspalte &amp; Layout</div>
              </div>
              <div class="settings-card-body">
                <div class="kv"><label>Breite rechts (%)</label><input id="rightW" class="input" type="number" min="0" max="70" value="38"></div>
                <div class="kv"><label>Schnitt oben (%)</label><input id="cutTop" class="input" type="number" min="0" max="100" value="28"></div>
                <div class="kv"><label>Schnitt unten (%)</label><input id="cutBottom" class="input" type="number" min="0" max="100" value="12"></div>
                <div class="help">Bestimmt Breite der Bildspalte und die beiden Ankerpunkte (oben/unten) der diagonalen Schnittkante.</div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-head">
                <div class="settings-card-title">Flammen / Hervorhebungen</div>
              </div>
              <div class="settings-card-body">
                <div class="kv"><label>Highlight aktiv</label><input id="hlEnabled" type="checkbox"></div>
                <div class="kv"><label>Highlight‚ÄëFarbe (Hex)</label><div class="color-item"><div id="hlSw" class="swatch"></div><input id="hlColor" class="input" type="text" value="#FFDD66" placeholder="#RRGGBB"></div></div>
                <div class="kv"><label>Min. vor Start</label><input id="hlBefore" class="input" type="number" min="0" max="120" value="15"></div>
                <div class="kv"><label>Min. nach Start</label><input id="hlAfter" class="input" type="number" min="0" max="120" value="15"></div>
                <div class="kv"><label>Flammen‚ÄëBild</label>
                  <div class="row" style="gap:8px">
                    <img id="flamePrev" class="prev" alt="">
                    <input id="flameImg" type="hidden" />
                    <label class="btn sm ghost" style="position:relative;overflow:hidden"><input id="flameFile" type="file" accept="image/*" style="position:absolute;inset:0;opacity:0">Upload</label>
                    <button class="btn sm" id="resetFlame">Default</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
</details>

        <details class="ac full" id="colorsOverview">
        <summary>
          <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> Farben (√úbersicht & Zeitspalte)</div>
          <div class="actions"><button class="btn sm ghost" id="resetColors">Standardwerte</button></div>
        </summary>
        <div class="content color-cols" id="colorList"></div>
      </details>

        <details class="ac" id="systemSettings">
        <summary>
          <div class="ttl">‚ñ∂<span class="chev">‚Æû</span> System</div>
        </summary>
        <div class="content">
          <div class="sys-grid">
            <div class="sys-action">
              <button class="btn icon-label" id="btnExport">
                <span class="icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M12 3a1 1 0 0 1 .82.42l4 5.5A1 1 0 0 1 16 10h-3v6a1 1 0 1 1-2 0v-6H8a1 1 0 0 1-.82-1.58l4-5.5A1 1 0 0 1 12 3zm8 16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2h16z" fill="currentColor"/>
                  </svg>
                </span>
                <span>Export</span>
              </button>
            </div>
            <div class="sys-options">
              <label class="btn sm ghost sys-toggle">
                <input type="checkbox" id="expWithSettings" checked>
                <span>Einst.</span>
              </label>
              <label class="btn sm ghost sys-toggle">
                <input type="checkbox" id="expWithSchedule" checked>
                <span>Zeiten</span>
              </label>
              <label class="btn sm ghost sys-toggle">
                <input type="checkbox" id="expWithImg">
                <span>Bilder</span>
              </label>
            </div>
            <div class="sys-action">
              <label class="btn icon-label sys-file-btn">
                <span class="icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M12 21a1 1 0 0 1-.82-.42l-4-5.5A1 1 0 0 1 8 14h3V8a1 1 0 0 1 2 0v6h3a1 1 0 0 1 .82 1.58l-4 5.5A1 1 0 0 1 12 21zM4 5a1 1 0 0 1 0-2h16a1 1 0 0 1 0 2H4z" fill="currentColor"/>
                  </svg>
                </span>
                <span>Import</span>
                <input id="importFile" type="file" accept="application/json">
              </label>
            </div>
            <div class="sys-options">
              <label class="btn sm ghost sys-toggle">
                <input type="checkbox" id="impWriteSettings" checked>
                <span>Einst.</span>
              </label>
              <label class="btn sm ghost sys-toggle">
                <input type="checkbox" id="impWriteSchedule" checked>
                <span>Zeiten</span>
              </label>
              <label class="btn sm ghost sys-toggle">
                <input type="checkbox" id="impWriteImg" checked>
                <span>Bilder</span>
              </label>
            </div>
          </div>
          <div class="sys-cleanup">
            <button class="btn sm ghost" id="btnCleanupSys">Assets aufr√§umen</button>
            <button class="btn sm" id="btnUsers">Benutzer</button>
          </div>
          <small class="help">Export/Import von Einstellungen & Plan. ‚ÄûBilder einschlie√üen‚Äú packt Flamme & Saunen-Bilder mit ein.</small>
        </div>
      </details>

      </div>
    </section>

  </main>

  <footer>¬© Andrej Soennecken</footer>

  <!-- Dialog Zelle -->
  <div id="modal" class="modal">
    <div class="box">
      <div class="grid2">
        <label>Uhrzeit</label><input id="m_time" class="input" type="text" placeholder="HH:MM">
        <label>Titel</label><input id="m_title" class="input" type="text" placeholder="z.B. Vulkan">
        <label>Flammen</label>
        <select id="m_flames" class="input">
          <option value="">‚Äî</option>
          <option>1</option><option>2</option><option>3</option>
        </select>
        <label>Fu√ünote</label>
        <div>
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="m_hasNote"> hinzuf√ºgen</label>
          <div class="row" id="m_noteRow" style="margin-top:8px;display:none">
            <select id="m_note" class="input"></select>
          </div>
        </div>
        <label>Beschreibung</label>
        <textarea id="m_description" class="input" rows="3" placeholder="Kurze Beschreibung oder Ritual"></textarea>
        <label>Badges</label>
        <div id="m_badgeList" class="badge-picker"></div>
      </div>
      <div class="row" style="justify-content:flex-end;margin-top:14px">
        <button class="btn" id="m_cancel">Abbrechen</button>
        <button class="btn primary" id="m_ok">OK</button>
      </div>
    </div>
  </div>

<!-- Ger√§te-Vorschau (ohne Pairing) ‚Äì ACHTUNG: SIBLING, NICHT im prevModal! -->
<div id="devPrevModal" class="modal">
  <div class="box">
    <div class="row" style="justify-content:space-between;margin-bottom:10px">
      <div style="font-weight:700" data-devprev-title>Ger√§te-Ansicht</div>
      <div class="row">
        <button class="btn sm" id="devPrevReload">Neu laden</button>
        <button class="btn sm" id="devPrevClose">Schlie√üen</button>
      </div>
    </div>
    <div class="iframeWrap">
      <iframe id="devPrevFrame" src="about:blank" loading="lazy" referrerpolicy="no-referrer"></iframe>
    </div>
    <small class="mut" style="display:block;margin-top:8px">
      Live-Ansicht des ausgew√§hlten Ger√§ts (nur Lesen; kein Pairing, keine Speicherung).
    </small>
  </div>
</div>

<div id="userModal" class="modal">
  <div class="box user-modal-box" role="dialog" aria-modal="true" aria-labelledby="userModalTitle">
    <div class="user-modal-head">
      <div>
        <h2 id="userModalTitle">Benutzer &amp; Rollen</h2>
        <p class="mut">Verwalte Konten, Zugriffsrechte und Passw√∂rter f√ºr das Admin-Interface.</p>
      </div>
      <button type="button" class="btn sm ghost" data-user-close>Schlie√üen</button>
    </div>
    <div class="user-modal-body">
      <section class="user-list-section">
        <div class="user-list-head">
          <h3>Konten</h3>
          <button type="button" class="btn sm" id="userCreateBtn">Neu</button>
        </div>
        <table class="user-table" aria-label="Benutzerliste">
          <thead>
            <tr>
              <th scope="col">Benutzer</th>
              <th scope="col">Rollen</th>
              <th scope="col" class="user-actions-head">Aktionen</th>
            </tr>
          </thead>
          <tbody data-user-table></tbody>
        </table>
        <p class="mut user-empty" data-user-empty hidden>Keine Benutzer konfiguriert.</p>
      </section>
      <section class="user-form-section">
        <form id="userForm" class="user-form">
          <h3 data-user-form-title>Benutzer anlegen</h3>
          <div class="user-status" data-user-status role="status" aria-live="polite"></div>
          <label class="user-field">
            <span>Benutzername</span>
            <input type="text" id="userUsername" name="username" required autocomplete="username" pattern="[a-zA-Z0-9_.-]{3,}" placeholder="z.&nbsp;B. redaktion" />
          </label>
          <label class="user-field">
            <span>Anzeigename</span>
            <input type="text" id="userDisplay" name="displayName" autocomplete="name" placeholder="Optional" />
          </label>
          <fieldset class="user-field">
            <legend>Rollen</legend>
            <div class="user-role-options" data-role-options></div>
          </fieldset>
          <label class="user-field">
            <span>Passwort</span>
            <input type="password" id="userPassword" name="password" autocomplete="new-password" />
            <span class="mut user-password-hint" data-user-password-hint>Passwort wird beim Speichern gesetzt.</span>
          </label>
          <div class="user-form-actions">
            <button type="submit" class="btn primary">Speichern</button>
            <button type="button" class="btn" data-user-cancel>Zur√ºcksetzen</button>
            <button type="button" class="btn ghost" data-user-close>Schlie√üen</button>
          </div>
        </form>
      </section>
    </div>
  </div>
</div>

<div id="helpOverlay" hidden>
  <div class="panel">
    <button id="helpClose" class="btn icon" aria-label="Schlie√üen">‚úï</button>
    <h2>Schnellstart</h2>
    <ul>
      <li>Nutze ‚ÄûSauna hinzuf√ºgen‚Äú, um neue Slides zu erstellen.</li>
      <li>Wechsle zur Ansicht ‚ÄûGer√§te‚Äú, um Displays zu bearbeiten.</li>
      <li>Achte auf die ‚Äû?‚Äú Buttons f√ºr kontextbezogene Hilfe direkt an den Bedienelementen.</li>
    </ul>
    <p>Mehr Hilfe in der <a href="/admin/help.md" target="_blank">Dokumentation</a>.</p>
  </div>
</div>

    </div>
  </div>

script>
  (function(){
    const actionButtons = document.querySelectorAll('.workspace-card [data-jump], .workspace-card [data-view], .workspace-card [data-devices]');
    if (!actionButtons.length) return;

    const ensureDetailsOpen = (element) => {
      if (!element) return;
      if (element.matches('details')) {
        element.open = true;
      }
      let parent = element.closest('details');
      while (parent) {
        parent.open = true;
        parent = parent.parentElement?.closest('details');
      }
    };

    const getScrollTarget = (element) => {
      if (!element) return null;
      if (element.hasAttribute('data-jump-target')) {
        return element;
      }
      return element.closest('[data-jump-target]') || element;
    };

    const highlight = (element) => {
      if (!element) return;
      element.classList.remove('jump-flash');
      void element.offsetWidth;
      element.classList.add('jump-flash');
      window.setTimeout(() => element.classList.remove('jump-flash'), 1600);
    };

    const canFocus = (element) => {
      if (!(element instanceof HTMLElement)) return false;
      if (element.tabIndex >= 0) return true;
      return /^(A|BUTTON|SUMMARY|INPUT|SELECT|TEXTAREA)$/i.test(element.tagName);
    };

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

<script>
  (function(){
    const shell = document.querySelector('.admin-shell');
    const toggle = document.getElementById('navToggle');
    const overlay = document.querySelector('[data-role="sidebar-overlay"]');
    if (!shell || !toggle) return;

    const updateExpanded = () => {
      const expanded = shell.classList.contains('sidebar-open');
      toggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    };

    const closeSidebar = () => {
      shell.classList.remove('sidebar-open');
      updateExpanded();
    };

    const openSidebar = () => {
      shell.classList.add('sidebar-open');
      updateExpanded();
    };

    toggle.addEventListener('click', () => {
      if (shell.classList.contains('sidebar-open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    overlay?.addEventListener('click', closeSidebar);

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') closeSidebar();
    });

    const autoClose = typeof window.matchMedia === 'function' ? window.matchMedia('(max-width: 1024px)') : null;
    if (autoClose && typeof autoClose.addEventListener === 'function') {
      autoClose.addEventListener('change', (event) => {
        if (!event.matches) closeSidebar();
      });
    }

    shell.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', () => {
        if (window.matchMedia && window.matchMedia('(max-width: 1024px)').matches) {
          closeSidebar();
        }
      });
    });

    updateExpanded();
  })();
</script>

<script>
  (function(){
    const menu = document.querySelector('[data-shell-menu]');
    const panelsHost = document.getElementById('workspacePanels');
    if (!menu || !panelsHost) return;

    const groups = Array.from(menu.querySelectorAll('[data-shell-group]'));
    const panels = Array.from(panelsHost.querySelectorAll('.workspace-panel'));
    const panelLookup = new Map(panels.map((panel) => [panel.dataset.panel, panel]));
    let activeButton = null;
    let activePanelId = null;

    const ensureDetailsOpen = (element) => {
      if (!element) return;
      if (element.matches('details')) {
        element.open = true;
      }
      let parent = element.closest('details');
      while (parent) {
        parent.open = true;
        parent = parent.parentElement?.closest('details');
      }
    };

    const getScrollTarget = (element) => {
      if (!element) return null;
      if (element.hasAttribute('data-jump-target')) {
        return element;
      }
      return element.closest('[data-jump-target]') || element;
    };

    const highlight = (element) => {
      if (!element) return;
      element.classList.remove('jump-flash');
      void element.offsetWidth;
      element.classList.add('jump-flash');
      window.setTimeout(() => element.classList.remove('jump-flash'), 1600);
    };

    const canFocus = (element) => {
      if (!(element instanceof HTMLElement)) return false;
      if (element.tabIndex >= 0) return true;
      return /^(A|BUTTON|SUMMARY|INPUT|SELECT|TEXTAREA)$/i.test(element.tagName);
    };

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    const waitForElement = async (selector, attempts = 6) => {
      if (!selector) return null;
      const existing = document.querySelector(selector);
      if (existing) return existing;
      if (attempts <= 0) return null;
      await sleep(120);
      return waitForElement(selector, attempts - 1);
    };

    const setActiveButton = (button) => {
      if (activeButton) activeButton.classList.remove('is-active');
      activeButton = button || null;
      if (activeButton) activeButton.classList.add('is-active');
    };

    const setActivePanel = (panelId) => {
      if (!panelLookup.has(panelId)) return false;
      panels.forEach((panel) => {
        panel.classList.toggle('is-active', panel.dataset.panel === panelId);
      });
      activePanelId = panelId;
      return true;
    };

    const revealGroupForPanel = (panelId) => {
      const button = menu.querySelector(`.sidebar-submenu-btn[data-panel="${panelId}"]`);
      if (!button) return;
      const group = button.closest('[data-shell-group]');
      if (!group) return;
      group.classList.add('is-open');
      const trigger = group.querySelector('[data-shell-trigger]');
      if (trigger) trigger.setAttribute('aria-expanded', 'true');
    };

    const showPanel = async ({ panel, focus, button }) => {
      if (!panel) return;
      if (!setActivePanel(panel)) return;
      setActiveButton(button || menu.querySelector(`.sidebar-submenu-btn[data-panel="${panel}"]`));
      revealGroupForPanel(panel);

      if (focus) {
        const target = await waitForElement(focus);
        if (target) {
          ensureDetailsOpen(target);
          const scrollTarget = getScrollTarget(target);
          window.requestAnimationFrame(() => {
            scrollTarget?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            const highlightEl = target.matches('details')
              ? target.querySelector(':scope > summary') || scrollTarget
              : scrollTarget;
            highlight(highlightEl);
            if (highlightEl && typeof highlightEl.focus === 'function' && canFocus(highlightEl)) {
              highlightEl.focus({ preventScroll: true });
            }
          });
        }
      }
    };

    menu.querySelectorAll('[data-shell-trigger]').forEach((trigger) => {
      const group = trigger.closest('[data-shell-group]');
      if (!group) return;
      trigger.setAttribute('aria-expanded', group.classList.contains('is-open') ? 'true' : 'false');
      trigger.addEventListener('click', () => {
        const expanded = !group.classList.contains('is-open');
        group.classList.toggle('is-open', expanded);
        trigger.setAttribute('aria-expanded', expanded ? 'true' : 'false');
      });
    });

    menu.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', async () => {
        const panel = button.dataset.panel;
        const focus = button.dataset.focus;
        await showPanel({ panel, focus, button });
      });
    });

    document.addEventListener('shell:show-panel', async (event) => {
      const detail = event?.detail || {};
      await showPanel({ panel: detail.panel, focus: detail.focus || null, button: null });
    });

    const defaultButton = menu.querySelector('.sidebar-submenu-btn[data-panel="planning"]') || menu.querySelector('.sidebar-submenu-btn');
    if (defaultButton) {
      const defaultGroup = defaultButton.closest('[data-shell-group]');
      if (defaultGroup) {
        defaultGroup.classList.add('is-open');
        const trigger = defaultGroup.querySelector('[data-shell-trigger]');
        if (trigger) trigger.setAttribute('aria-expanded', 'true');
      }
      showPanel({ panel: defaultButton.dataset.panel, focus: defaultButton.dataset.focus || null, button: defaultButton });
    }
  })();
</script>

<script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html><script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html><script>
  (function(){
    const shell = document.querySelector('.admin-shell');
    const toggle = document.getElementById('navToggle');
    const overlay = document.querySelector('[data-role="sidebar-overlay"]');
    if (!shell || !toggle) return;

    const updateExpanded = () => {
      const expanded = shell.classList.contains('sidebar-open');
      toggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    };

    const closeSidebar = () => {
      shell.classList.remove('sidebar-open');
      updateExpanded();
    };

    const openSidebar = () => {
      shell.classList.add('sidebar-open');
      updateExpanded();
    };

    toggle.addEventListener('click', () => {
      if (shell.classList.contains('sidebar-open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    overlay?.addEventListener('click', closeSidebar);

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') closeSidebar();
    });

    const autoClose = typeof window.matchMedia === 'function' ? window.matchMedia('(max-width: 1024px)') : null;
    if (autoClose && typeof autoClose.addEventListener === 'function') {
      autoClose.addEventListener('change', (event) => {
        if (!event.matches) closeSidebar();
      });
    }

    shell.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', () => {
        if (window.matchMedia && window.matchMedia('(max-width: 1024px)').matches) {
          closeSidebar();
        }
      });
    });

    updateExpanded();
  })();
</script>

<script>
  (function(){
    const menu = document.querySelector('[data-shell-menu]');
    const panelsHost = document.getElementById('workspacePanels');
    if (!menu || !panelsHost) return;

    const groups = Array.from(menu.querySelectorAll('[data-shell-group]'));
    const panels = Array.from(panelsHost.querySelectorAll('.workspace-panel'));
    const panelLookup = new Map(panels.map((panel) => [panel.dataset.panel, panel]));
    let activeButton = null;
    let activePanelId = null;

    const ensureDetailsOpen = (element) => {
      if (!element) return;
      if (element.matches('details')) {
        element.open = true;
      }
      let parent = element.closest('details');
      while (parent) {
        parent.open = true;
        parent = parent.parentElement?.closest('details');
      }
    };

    const getScrollTarget = (element) => {
      if (!element) return null;
      if (element.hasAttribute('data-jump-target')) {
        return element;
      }
      return element.closest('[data-jump-target]') || element;
    };

    const highlight = (element) => {
      if (!element) return;
      element.classList.remove('jump-flash');
      void element.offsetWidth;
      element.classList.add('jump-flash');
      window.setTimeout(() => element.classList.remove('jump-flash'), 1600);
    };

    const canFocus = (element) => {
      if (!(element instanceof HTMLElement)) return false;
      if (element.tabIndex >= 0) return true;
      return /^(A|BUTTON|SUMMARY|INPUT|SELECT|TEXTAREA)$/i.test(element.tagName);
    };

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    const waitForElement = async (selector, attempts = 6) => {
      if (!selector) return null;
      const existing = document.querySelector(selector);
      if (existing) return existing;
      if (attempts <= 0) return null;
      await sleep(120);
      return waitForElement(selector, attempts - 1);
    };

    const setActiveButton = (button) => {
      if (activeButton) activeButton.classList.remove('is-active');
      activeButton = button || null;
      if (activeButton) activeButton.classList.add('is-active');
    };

    const setActivePanel = (panelId) => {
      if (!panelLookup.has(panelId)) return false;
      panels.forEach((panel) => {
        panel.classList.toggle('is-active', panel.dataset.panel === panelId);
      });
      activePanelId = panelId;
      return true;
    };

    const revealGroupForPanel = (panelId) => {
      const button = menu.querySelector(`.sidebar-submenu-btn[data-panel="${panelId}"]`);
      if (!button) return;
      const group = button.closest('[data-shell-group]');
      if (!group) return;
      group.classList.add('is-open');
      const trigger = group.querySelector('[data-shell-trigger]');
      if (trigger) trigger.setAttribute('aria-expanded', 'true');
    };

    const showPanel = async ({ panel, focus, button }) => {
      if (!panel) return;
      if (!setActivePanel(panel)) return;
      setActiveButton(button || menu.querySelector(`.sidebar-submenu-btn[data-panel="${panel}"]`));
      revealGroupForPanel(panel);

      if (focus) {
        const target = await waitForElement(focus);
        if (target) {
          ensureDetailsOpen(target);
          const scrollTarget = getScrollTarget(target);
          window.requestAnimationFrame(() => {
            scrollTarget?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            const highlightEl = target.matches('details')
              ? target.querySelector(':scope > summary') || scrollTarget
              : scrollTarget;
            highlight(highlightEl);
            if (highlightEl && typeof highlightEl.focus === 'function' && canFocus(highlightEl)) {
              highlightEl.focus({ preventScroll: true });
            }
          });
        }
      }
    };

    menu.querySelectorAll('[data-shell-trigger]').forEach((trigger) => {
      const group = trigger.closest('[data-shell-group]');
      if (!group) return;
      trigger.setAttribute('aria-expanded', group.classList.contains('is-open') ? 'true' : 'false');
      trigger.addEventListener('click', () => {
        const expanded = !group.classList.contains('is-open');
        group.classList.toggle('is-open', expanded);
        trigger.setAttribute('aria-expanded', expanded ? 'true' : 'false');
      });
    });

    menu.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', async () => {
        const panel = button.dataset.panel;
        const focus = button.dataset.focus;
        await showPanel({ panel, focus, button });
      });
    });

    document.addEventListener('shell:show-panel', async (event) => {
      const detail = event?.detail || {};
      await showPanel({ panel: detail.panel, focus: detail.focus || null, button: null });
    });

    const defaultButton = menu.querySelector('.sidebar-submenu-btn[data-panel="planning"]') || menu.querySelector('.sidebar-submenu-btn');
    if (defaultButton) {
      const defaultGroup = defaultButton.closest('[data-shell-group]');
      if (defaultGroup) {
        defaultGroup.classList.add('is-open');
        const trigger = defaultGroup.querySelector('[data-shell-trigger]');
        if (trigger) trigger.setAttribute('aria-expanded', 'true');
      }
      showPanel({ panel: defaultButton.dataset.panel, focus: defaultButton.dataset.focus || null, button: defaultButton });
    }
  })();
</script>

<script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html><script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html><script>
  (function(){
    const shell = document.querySelector('.admin-shell');
    const toggle = document.getElementById('navToggle');
    const overlay = document.querySelector('[data-role="sidebar-overlay"]');
    if (!shell || !toggle) return;

    const updateExpanded = () => {
      const expanded = shell.classList.contains('sidebar-open');
      toggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    };

    const closeSidebar = () => {
      shell.classList.remove('sidebar-open');
      updateExpanded();
    };

    const openSidebar = () => {
      shell.classList.add('sidebar-open');
      updateExpanded();
    };

    toggle.addEventListener('click', () => {
      if (shell.classList.contains('sidebar-open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    overlay?.addEventListener('click', closeSidebar);

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') closeSidebar();
    });

    const autoClose = typeof window.matchMedia === 'function' ? window.matchMedia('(max-width: 1024px)') : null;
    if (autoClose && typeof autoClose.addEventListener === 'function') {
      autoClose.addEventListener('change', (event) => {
        if (!event.matches) closeSidebar();
      });
    }

    shell.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', () => {
        if (window.matchMedia && window.matchMedia('(max-width: 1024px)').matches) {
          closeSidebar();
        }
      });
    });

    updateExpanded();
  })();
</script>

<script>
  (function(){
    const menu = document.querySelector('[data-shell-menu]');
    const panelsHost = document.getElementById('workspacePanels');
    if (!menu || !panelsHost) return;

    const groups = Array.from(menu.querySelectorAll('[data-shell-group]'));
    const panels = Array.from(panelsHost.querySelectorAll('.workspace-panel'));
    const panelLookup = new Map(panels.map((panel) => [panel.dataset.panel, panel]));
    let activeButton = null;
    let activePanelId = null;

    const ensureDetailsOpen = (element) => {
      if (!element) return;
      if (element.matches('details')) {
        element.open = true;
      }
      let parent = element.closest('details');
      while (parent) {
        parent.open = true;
        parent = parent.parentElement?.closest('details');
      }
    };

    const getScrollTarget = (element) => {
      if (!element) return null;
      if (element.hasAttribute('data-jump-target')) {
        return element;
      }
      return element.closest('[data-jump-target]') || element;
    };

    const highlight = (element) => {
      if (!element) return;
      element.classList.remove('jump-flash');
      void element.offsetWidth;
      element.classList.add('jump-flash');
      window.setTimeout(() => element.classList.remove('jump-flash'), 1600);
    };

    const canFocus = (element) => {
      if (!(element instanceof HTMLElement)) return false;
      if (element.tabIndex >= 0) return true;
      return /^(A|BUTTON|SUMMARY|INPUT|SELECT|TEXTAREA)$/i.test(element.tagName);
    };

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    const waitForElement = async (selector, attempts = 6) => {
      if (!selector) return null;
      const existing = document.querySelector(selector);
      if (existing) return existing;
      if (attempts <= 0) return null;
      await sleep(120);
      return waitForElement(selector, attempts - 1);
    };

    const setActiveButton = (button) => {
      if (activeButton) activeButton.classList.remove('is-active');
      activeButton = button || null;
      if (activeButton) activeButton.classList.add('is-active');
    };

    const setActivePanel = (panelId) => {
      if (!panelLookup.has(panelId)) return false;
      panels.forEach((panel) => {
        panel.classList.toggle('is-active', panel.dataset.panel === panelId);
      });
      activePanelId = panelId;
      return true;
    };

    const revealGroupForPanel = (panelId) => {
      const button = menu.querySelector(`.sidebar-submenu-btn[data-panel="${panelId}"]`);
      if (!button) return;
      const group = button.closest('[data-shell-group]');
      if (!group) return;
      group.classList.add('is-open');
      const trigger = group.querySelector('[data-shell-trigger]');
      if (trigger) trigger.setAttribute('aria-expanded', 'true');
    };

    const showPanel = async ({ panel, focus, button }) => {
      if (!panel) return;
      if (!setActivePanel(panel)) return;
      setActiveButton(button || menu.querySelector(`.sidebar-submenu-btn[data-panel="${panel}"]`));
      revealGroupForPanel(panel);

      if (focus) {
        const target = await waitForElement(focus);
        if (target) {
          ensureDetailsOpen(target);
          const scrollTarget = getScrollTarget(target);
          window.requestAnimationFrame(() => {
            scrollTarget?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            const highlightEl = target.matches('details')
              ? target.querySelector(':scope > summary') || scrollTarget
              : scrollTarget;
            highlight(highlightEl);
            if (highlightEl && typeof highlightEl.focus === 'function' && canFocus(highlightEl)) {
              highlightEl.focus({ preventScroll: true });
            }
          });
        }
      }
    };

    menu.querySelectorAll('[data-shell-trigger]').forEach((trigger) => {
      const group = trigger.closest('[data-shell-group]');
      if (!group) return;
      trigger.setAttribute('aria-expanded', group.classList.contains('is-open') ? 'true' : 'false');
      trigger.addEventListener('click', () => {
        const expanded = !group.classList.contains('is-open');
        group.classList.toggle('is-open', expanded);
        trigger.setAttribute('aria-expanded', expanded ? 'true' : 'false');
      });
    });

    menu.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', async () => {
        const panel = button.dataset.panel;
        const focus = button.dataset.focus;
        await showPanel({ panel, focus, button });
      });
    });

    document.addEventListener('shell:show-panel', async (event) => {
      const detail = event?.detail || {};
      await showPanel({ panel: detail.panel, focus: detail.focus || null, button: null });
    });

    const defaultButton = menu.querySelector('.sidebar-submenu-btn[data-panel="planning"]') || menu.querySelector('.sidebar-submenu-btn');
    if (defaultButton) {
      const defaultGroup = defaultButton.closest('[data-shell-group]');
      if (defaultGroup) {
        defaultGroup.classList.add('is-open');
        const trigger = defaultGroup.querySelector('[data-shell-trigger]');
        if (trigger) trigger.setAttribute('aria-expanded', 'true');
      }
      showPanel({ panel: defaultButton.dataset.panel, focus: defaultButton.dataset.focus || null, button: defaultButton });
    }
  })();
</script>

<script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html><script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html><script>
  (function(){
    const shell = document.querySelector('.admin-shell');
    const toggle = document.getElementById('navToggle');
    const overlay = document.querySelector('[data-role="sidebar-overlay"]');
    if (!shell || !toggle) return;

    const updateExpanded = () => {
      const expanded = shell.classList.contains('sidebar-open');
      toggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    };

    const closeSidebar = () => {
      shell.classList.remove('sidebar-open');
      updateExpanded();
    };

    const openSidebar = () => {
      shell.classList.add('sidebar-open');
      updateExpanded();
    };

    toggle.addEventListener('click', () => {
      if (shell.classList.contains('sidebar-open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    overlay?.addEventListener('click', closeSidebar);

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') closeSidebar();
    });

    const autoClose = typeof window.matchMedia === 'function' ? window.matchMedia('(max-width: 1024px)') : null;
    if (autoClose && typeof autoClose.addEventListener === 'function') {
      autoClose.addEventListener('change', (event) => {
        if (!event.matches) closeSidebar();
      });
    }

    shell.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', () => {
        if (window.matchMedia && window.matchMedia('(max-width: 1024px)').matches) {
          closeSidebar();
        }
      });
    });

    updateExpanded();
  })();
</script>

<script>
  (function(){
    const menu = document.querySelector('[data-shell-menu]');
    const panelsHost = document.getElementById('workspacePanels');
    if (!menu || !panelsHost) return;

    const groups = Array.from(menu.querySelectorAll('[data-shell-group]'));
    const panels = Array.from(panelsHost.querySelectorAll('.workspace-panel'));
    const panelLookup = new Map(panels.map((panel) => [panel.dataset.panel, panel]));
    let activeButton = null;
    let activePanelId = null;

    const ensureDetailsOpen = (element) => {
      if (!element) return;
      if (element.matches('details')) {
        element.open = true;
      }
      let parent = element.closest('details');
      while (parent) {
        parent.open = true;
        parent = parent.parentElement?.closest('details');
      }
    };

    const getScrollTarget = (element) => {
      if (!element) return null;
      if (element.hasAttribute('data-jump-target')) {
        return element;
      }
      return element.closest('[data-jump-target]') || element;
    };

    const highlight = (element) => {
      if (!element) return;
      element.classList.remove('jump-flash');
      void element.offsetWidth;
      element.classList.add('jump-flash');
      window.setTimeout(() => element.classList.remove('jump-flash'), 1600);
    };

    const canFocus = (element) => {
      if (!(element instanceof HTMLElement)) return false;
      if (element.tabIndex >= 0) return true;
      return /^(A|BUTTON|SUMMARY|INPUT|SELECT|TEXTAREA)$/i.test(element.tagName);
    };

    const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    const waitForElement = async (selector, attempts = 6) => {
      if (!selector) return null;
      const existing = document.querySelector(selector);
      if (existing) return existing;
      if (attempts <= 0) return null;
      await sleep(120);
      return waitForElement(selector, attempts - 1);
    };

    const setActiveButton = (button) => {
      if (activeButton) activeButton.classList.remove('is-active');
      activeButton = button || null;
      if (activeButton) activeButton.classList.add('is-active');
    };

    const setActivePanel = (panelId) => {
      if (!panelLookup.has(panelId)) return false;
      panels.forEach((panel) => {
        panel.classList.toggle('is-active', panel.dataset.panel === panelId);
      });
      activePanelId = panelId;
      return true;
    };

    const revealGroupForPanel = (panelId) => {
      const button = menu.querySelector(`.sidebar-submenu-btn[data-panel="${panelId}"]`);
      if (!button) return;
      const group = button.closest('[data-shell-group]');
      if (!group) return;
      group.classList.add('is-open');
      const trigger = group.querySelector('[data-shell-trigger]');
      if (trigger) trigger.setAttribute('aria-expanded', 'true');
    };

    const showPanel = async ({ panel, focus, button }) => {
      if (!panel) return;
      if (!setActivePanel(panel)) return;
      setActiveButton(button || menu.querySelector(`.sidebar-submenu-btn[data-panel="${panel}"]`));
      revealGroupForPanel(panel);

      if (focus) {
        const target = await waitForElement(focus);
        if (target) {
          ensureDetailsOpen(target);
          const scrollTarget = getScrollTarget(target);
          window.requestAnimationFrame(() => {
            scrollTarget?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            const highlightEl = target.matches('details')
              ? target.querySelector(':scope > summary') || scrollTarget
              : scrollTarget;
            highlight(highlightEl);
            if (highlightEl && typeof highlightEl.focus === 'function' && canFocus(highlightEl)) {
              highlightEl.focus({ preventScroll: true });
            }
          });
        }
      }
    };

    menu.querySelectorAll('[data-shell-trigger]').forEach((trigger) => {
      const group = trigger.closest('[data-shell-group]');
      if (!group) return;
      trigger.setAttribute('aria-expanded', group.classList.contains('is-open') ? 'true' : 'false');
      trigger.addEventListener('click', () => {
        const expanded = !group.classList.contains('is-open');
        group.classList.toggle('is-open', expanded);
        trigger.setAttribute('aria-expanded', expanded ? 'true' : 'false');
      });
    });

    menu.querySelectorAll('.sidebar-submenu-btn').forEach((button) => {
      button.addEventListener('click', async () => {
        const panel = button.dataset.panel;
        const focus = button.dataset.focus;
        await showPanel({ panel, focus, button });
      });
    });

    document.addEventListener('shell:show-panel', async (event) => {
      const detail = event?.detail || {};
      await showPanel({ panel: detail.panel, focus: detail.focus || null, button: null });
    });

    const defaultButton = menu.querySelector('.sidebar-submenu-btn[data-panel="planning"]') || menu.querySelector('.sidebar-submenu-btn');
    if (defaultButton) {
      const defaultGroup = defaultButton.closest('[data-shell-group]');
      if (defaultGroup) {
        defaultGroup.classList.add('is-open');
        const trigger = defaultGroup.querySelector('[data-shell-trigger]');
        if (trigger) trigger.setAttribute('aria-expanded', 'true');
      }
      showPanel({ panel: defaultButton.dataset.panel, focus: defaultButton.dataset.focus || null, button: defaultButton });
    }
  })();
</script>

<script>

  (function(){
    const p = '__PUBLIC_PORT__';
    const proto = location.protocol;
    const def = proto === 'https:' ? '443' : '80';
    let port = /^\d+$/.test(p) ? p : def;
    const suffix = port === def ? '' : ':' + port;
    window.SLIDESHOW_ORIGIN = `${proto}//${location.hostname}${suffix}`;
  })();

</script>
<script type="module" src="/admin/js/help.js"></script>
<script type="module" src="/admin/js/app.js"></script>
</body>
</html>
